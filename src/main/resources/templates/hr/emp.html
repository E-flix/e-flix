<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{common/layouts/default}">
<!-- ============================================
  - ì‘ì„±ì   : ê¹€ì–´ì§„
  - ìµœì´ˆì‘ì„± : 2025-06-18
  - ì„¤ëª…     : ì‚¬ì› ì¡°íšŒí™”ë©´ (ê´€ë¦¬ì)
  -----------------------------------------------
  [ ë³€ê²½ ì´ë ¥ ]
  - 2025-06-18 (ê¹€ì–´ì§„): title ë° ë‚´ìš© ì¶”ê°€
  - 2025-06-19 (ê¹€ì–´ì§„): layout êµ¬ì„± ë° ëª¨ë‹¬ì°½ ìƒì„±
  - 2025-06-20 (ê¹€ì–´ì§„): ì‚¬ì› ì „ì²´ì¡°íšŒ êµ¬í˜„
  - 2025-06-23 (ê¹€ì–´ì§„): ì¡°ê±´ë³„ ê²€ìƒ‰ êµ¬í˜„
============================================ -->

<head>
  <title>ì‚¬ì›ê´€ë¦¬</title>
</head>

<div layout:fragment="content">
  <div class="w-100" id="empList">
    <div class="d-flex justify-content-between align-items-center mb-1">
      <h3>ì‚¬ì›ê´€ë¦¬</h3>
    </div>
    <div class="py-4">
      <!-- ì‚¬ì›ë“±ë¡ / ìˆ˜ì • ë²„íŠ¼ -->
      <div class="d-flex justify-content-end mb-2 gap-2">
        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#employeeModal">
          ì‚¬ì›ë“±ë¡
        </button>
        <button class="btn btn-primary">ì‚¬ì›ìˆ˜ì •</button>
      </div>

      <!-- ê²€ìƒ‰ í•„í„° -->
      <form>
        <div class="p-4 bg-light rounded mb-4">
          <div class="row g-3 align-items-center mb-3">
            <div class="col-md-2"><label class="form-label">ê²€ìƒ‰ ê¸°ì¤€</label></div>
            <div class="col-md-2">
              <select name="option" class="form-select" id="searchSelect">
                <option>ì „ì²´</option>
                <option value="empName" th:selected="${option=='empName'}">ì‚¬ì›ëª…</option>
                <option value="empIdx" th:selected="${option=='empIdx'}">ì‚¬ì›ID</option>
              </select>
            </div>
            <div class="col-md-4">
              <input type="text" name="keyword" class="form-control" id="searchInput" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥ í›„ [enter]">
            </div>
          </div>
          <div class="row g-3 mb-3">
            <div class="col-md-2">
              <label class="form-label">ë¶€ì„œ</label>
            </div>
            <div class="col-md-2">
              <select id="deptSelect" name="deptUpIdx" class="form-select">
                <option>ì„ íƒ</option>
                <!-- ìµœìƒìœ„ ë¶€ì„œ ëª©ë¡ ë°”ì¸ë”© -->
                <option th:each="d : ${depts}" th:value="${d.deptIdx}" th:text="${d.deptName}">
                </option>
              </select>
            </div>
            <div class="col-md-2">
              <label class="form-label">ìƒì„¸ ë¶€ì„œ</label>
            </div>
            <div class="col-md-2">
              <select id="detailDeptSelect" name="deptIdx" class="form-select">
                <option>ì„ íƒ</option>
              </select>
            </div>
          </div>
          <script>
            $(document).ready(function () {
              $('#deptSelect').on('change', function () {
                var parentIdx = $(this).val();
                var $child = $('#detailDeptSelect');
                $child.html('<option value="">ì„ íƒ</option>'); // ì´ˆê¸°í™”

                if (!parentIdx) {
                  return; // ì„ íƒ í•´ì œ ì‹œ ì¢…ë£Œ
                }

                // jQuery AJAX í˜¸ì¶œ
                $.ajax({
                  type: 'GET',
                  url: `/hr/${parentIdx}/children`,
                  success: function (res) {
                    $.each(res, function (i, d) {
                      $('<option>')
                        .val(d.deptIdx)
                        .text(d.deptName)
                        .appendTo($child);
                    });
                  },
                  error: function (req, xhr, err) {
                    console.error(err)
                  }
                });
              });
            });
          </script>

          <div class="row g-3 mb-3 align-items-center">
            <div class="col-md-2">
              <label class="form-label">ì§ê¸‰</label>
            </div>
            <div class="col-md-2">
              <select name="option" class="form-select" id="searchSelect">
                <option>ì„ íƒ</option>
                <option value="empGrade" th:selected="${option=='empGrade'}"></option>
              </select>
            </div>
            <div class="col-md-2"><label class="form-label">ì¬ì§ ìƒíƒœ</label></div>
            <div class="col-md-2"><select class="form-select">
                <option>ì„ íƒ</option>
              </select></div>
            <div class="col-md-2"><label class="form-label">ê·¼ë¬´ ìœ í˜•</label></div>
            <div class="col-md-2"><select class="form-select">
                <option>ì„ íƒ</option>
              </select></div>
          </div>

          <div class="d-flex justify-content-center gap-3">
            <button type="submit" class="btn btn-primary" id="searchBtn">ì¡°íšŒ</button>
            <button class="btn btn-secondary">ì´ˆê¸°í™”</button>
          </div>
      </form>
      <!-- <script>
        $("#searchBtn").on("click", () => {
          let searchInput = $("#searchInput").val();
          let searchSelect = $("#searchSelect").val();

          $.ajax({
            type: "GET",
            url: `/hr/el?option=${searchSelect}&keyword=${searchInput}`,
            success: function(res) {
              console.log(res);
            },
            error: function(xhr, status, err) {
              console.log(err);
            }
          })
        });
      </script> -->
      
  <!-- 4. ì‚¬ì›ë“±ë¡ ëª¨ë‹¬ -->
  <div class="modal fade" id="employeeModal" tabindex="-1" aria-labelledby="employeeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content p-3">
        <div class="modal-header">
          <h5 class="modal-title fw-bold">ì‚¬ì›ë“±ë¡</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
        </div>

        <div class="modal-body">
          <!-- íƒ­ ë©”ë‰´ -->
          <ul class="nav nav-tabs mb-3">
            <li class="nav-item">
              <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#basicInfo">ê¸°ë³¸ì •ë³´</button>
            </li>
            <li class="nav-item">
              <button class="nav-link" data-bs-toggle="tab" data-bs-target="#extraInfo">ì¶”ê°€ì •ë³´</button>
            </li>
          </ul>

          <div class="tab-content">
            <!-- ê¸°ë³¸ì •ë³´ -->
            <div class="tab-pane fade show active" id="basicInfo">
              <div class="row">
                <div class="col-md-3 text-center">
                  <img src="https://via.placeholder.com/100x140?text=ì‚¬ì§„" class="img-thumbnail mb-2" alt="ì‚¬ì›ì‚¬ì§„">
                  <div class="mb-3">
                    <label class="form-label">íŒŒì¼ì„ íƒ</label>
                    <input class="form-control" type="file">
                  </div>
                  <div>
                    <label class="form-label">ê·¼ë¡œê³„ì•½ì„œ*</label>
                    <input class="form-control" type="file">
                  </div>
                </div>

                <div class="col-md-9">
                  <div class="row g-2 mb-2">
                    <div class="col-md-3"><label class="form-label">ì‚¬ì›ë²ˆí˜¸</label></div>
                    <div class="col-md-3"><input type="text" class="form-control"></div>
                    <div class="col-md-3"><label class="form-label">ì‚¬ì›ëª…</label></div>
                    <div class="col-md-3"><input type="text" class="form-control" placeholder="ì‚¬ì›ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></div>
                  </div>

                  <div class="row g-2 mb-2">
                    <div class="col-md-3"><label class="form-label">ì£¼ë¯¼ë²ˆí˜¸</label></div>
                    <div class="col-md-3"><input type="text" class="form-control" placeholder="ì• 6ìë¦¬"></div>
                    <div class="col-md-1 text-center">-</div>
                    <div class="col-md-3"><input type="text" class="form-control" placeholder="ë’¤ 7ìë¦¬"></div>
                  </div>

                  <div class="row g-2 mb-2">
                    <div class="col-md-3"><label class="form-label">ì´ë©”ì¼(ID)</label></div>
                    <div class="col-md-3"><input type="email" class="form-control" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”"></div>
                    <div class="col-md-3"><label class="form-label">ì—°ë½ì²˜</label></div>
                    <div class="col-md-3"><input type="text" class="form-control" placeholder="'-' ì—†ì´ ì…ë ¥"></div>
                  </div>

                  <div class="row g-2 mb-2">
                    <div class="col-md-3"><label class="form-label">ë¹„ë°€ë²ˆí˜¸</label></div>
                    <div class="col-md-3"><input type="password" class="form-control"></div>
                    <div class="col-md-3"><label class="form-label">ì…ì‚¬ì¼</label></div>
                    <div class="col-md-3"><input type="date" class="form-control"></div>
                  </div>

                  <div class="row g-2 mb-2">
                    <div class="col-md-3"><label class="form-label">ë¶€ì„œ</label></div>
                    <div class="col-md-3"><select class="form-select">
                        <option>ì„ íƒ</option>
                      </select></div>
                    <div class="col-md-3"><label class="form-label">ì§ê¸‰</label></div>
                    <div class="col-md-3"><select class="form-select">
                        <option>ì„ íƒ</option>
                      </select></div>
                  </div>

                  <div class="row g-2 mb-2">
                    <div class="col-md-3"><label class="form-label">ê¶Œí•œ</label></div>
                    <div class="col-md-3"><select class="form-select">
                        <option>ì„ íƒ</option>
                      </select></div>
                    <div class="col-md-3"><label class="form-label">ê·¼ë¬´ìœ í˜•</label></div>
                    <div class="col-md-3"><select class="form-select">
                        <option>ì„ íƒ</option>
                      </select></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ì¶”ê°€ì •ë³´ -->
            <div class="tab-pane fade" id="extraInfo">
              <div class="row mb-3">
                <div class="col-md-2"><label class="form-label">ê¸‰ì—¬ê³„ì¢Œ</label></div>
                <div class="col-md-4"><select class="form-select">
                    <option>ì„ íƒ</option>
                  </select></div>
              </div>

              <div class="mb-3">
                <label class="form-label">ì£¼ì†Œ</label>
                <div class="d-flex gap-2 mb-2">
                  <button class="btn btn-outline-danger">ğŸ“ ìš°í¸ë²ˆí˜¸ ê²€ìƒ‰</button>
                  <input type="text" class="form-control w-25" placeholder="ìš°í¸ë²ˆí˜¸">
                </div>
                <input type="text" class="form-control mb-2" placeholder="ê¸°ë³¸ ì£¼ì†Œ">
                <input type="text" class="form-control" placeholder="ìƒì„¸ì£¼ì†Œ ì…ë ¥">
              </div>

              <div class="mb-3">
                <label class="form-label">ë©”ëª¨</label>
                <textarea class="form-control" rows="5" placeholder="í•„ìš”ì‹œ ì…ë ¥í•˜ì„¸ìš”"></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- ëª¨ë‹¬ í•˜ë‹¨ ë²„íŠ¼ -->
        <div class="modal-footer justify-content-end">
          <button type="button" class="btn btn-primary">ë“±ë¡</button>
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          <button type="reset" class="btn btn-secondary">ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>
  </div>
    </div>
    <!-- 2. ì‚¬ì› í…Œì´ë¸” -->
    <div class="container-fluid px-0" style="height:100vh;">
      <div id="myGrid" class="ag-theme-alpine" style="width:100%; height:75%;"></div>
    </div>
  </div>
  <script th:inline="javascript">
    // Thymeleaf empList â†’ JS
    var rowData = /*[[${empList}]]*/ [];

    // ì»¬ëŸ¼ ì •ì˜
    const columnDefs = [{
        headerName: "",
        checkboxSelection: true,
        headerCheckboxSelection: true,
        width: 50
      },
      {
        headerName: "ì‚¬ì›ID",
        field: "empIdx",
        sortable: true,
        filter: true,
        resizable: true
      },
      {
        headerName: "ì‚¬ì›ëª…",
        field: "empName",
        sortable: true,
        filter: true,
        resizable: true
      },
      {
        headerName: "ë¶€ì„œ",
        field: "deptName",
        sortable: true,
        filter: true,
        resizable: true
      },
      {
        headerName: "ì§ê¸‰",
        field: "empGrade",
        sortable: true,
        filter: true,
        resizable: true
      },
      {
        headerName: "ì¬ì§ ìƒíƒœ",
        field: "empStatus",
        sortable: true,
        filter: true,
        resizable: true
      },
      {
        headerName: "ê·¼ë¬´ ìœ í˜•",
        field: "empType",
        sortable: true,
        filter: true,
        resizable: true
      },
      {
        headerName: "ì…ì‚¬ì¼",
        field: "empRegdate",
        sortable: true,
        filter: 'agDateColumnFilter',
        valueFormatter: params => new Date(params.value).toISOString().slice(0, 10)
      },
      {
        headerName: "ì—°ë½ì²˜",
        field: "empAccount",
        sortable: true,
        filter: true,
        resizable: true
      },
      {
        headerName: "ì´ë©”ì¼",
        field: "empEmail",
        sortable: true,
        filter: true,
        resizable: true
      },
      {
        headerName: "ê·¼ë¡œê³„ì•½ì„œ",
        field: "empIdx",
        cellRenderer: params => `<a href="/employees/${params.value}/contract" target="_blank">ë‹¤ìš´ë¡œë“œ</a>`,
        resizable: true
      }
    ];

    // ê·¸ë¦¬ë“œ ì˜µì…˜
    const gridOptions = {
      columnDefs,
      rowData,
      defaultColDef: {
        flex: 1,
        minWidth: 100
      },
      pagination: true,
      paginationPageSize: 20,
      rowSelection: 'multiple'
    };

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      // ê·¸ë¦¬ë“œ ìƒì„±
      agGrid.createGrid(document.querySelector("#myGrid"), gridOptions);

      // ë¶€ì„œ â†’ ìƒì„¸ë¶€ì„œ AJAX
      document.getElementById('deptSelect').addEventListener('change', function () {
        const detail = document.getElementById('detailDeptSelect');
        detail.innerHTML = '<option value="">ì„ íƒ</option>';
        if (!this.value) return;
        fetch(`/hr/${this.value}/children`)
          .then(r => r.json())
          .then(list => list.forEach(d => {
            const opt = document.createElement('option');
            opt.value = d.deptIdx;
            opt.textContent = d.deptName;
            detail.append(opt);
          }));
      });
    });
  </script>
</div>