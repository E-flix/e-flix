<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{common/layouts/default}">
<!-- ============================================
  - 작성자   : 김어진
  - 최초작성 : 2025-06-18
  - 설명     : 근태 관리화면 (관리자)
  -----------------------------------------------
  [ 변경 이력 ]
  - 2025-06-18 (김어진): title 및 내용 추가
  - 2025-06-19 (김어진): layout 구성
============================================ -->

<head>
    <title>근태관리</title>
</head>
<div layout:fragment="content">
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <!-- 헤더 -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="fw-bold text-dark mb-0">근태 관리</h2>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item"><a href="#" class="text-decoration-none">관리</a></li>
                            <li class="breadcrumb-item active" aria-current="page">근태 관리</li>
                        </ol>
                    </nav>
                </div>

                <!-- 필터 영역 -->
                <div class="card mb-4">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="card-title mb-0"><i class="bi bi-funnel me-2"></i>검색 조건</h5>
                    </div>
                    <div class="card-body">
                        <form class="row g-3">
                            <div class="col-md-6 col-lg-3">
                                <label class="form-label fw-semibold">사원명</label>
                                <input type="text" class="form-control" placeholder="검색어 입력" name="SearchEmpName">
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <label class="form-label fw-semibold">근무상태</label>
                                <select class="form-select" id="searchEmpType">
                                    <option value="">전체</option>
                                    <option value="정상">정상근무</option>
                                    <option value="지각">지각</option>
                                    <option value="조퇴">조퇴</option>
                                    <option value="결근">결근</option>
                                </select>
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <label class="form-label fw-semibold">부서</label>
                                <select name="deptUpIdx" class="form-select" id="searchDeptUpIdx">
                                    <option value="">전체</option>
                                    <option value="본사">본사</option>
                                </select>
                            </div>
                            <div class="col-md-6 col-lg-3">
                                <label class="form-label fw-semibold">상세 부서</label>
                                <select name="deptIdx" class="form-select" id="searchDeptDownIdx">
                                    <option value="">전체</option>
                                    <option value="인사부">인사부</option>
                                    <option value="영업부">영업부</option>
                                </select>
                            </div>
                            <div class="col-md-6 col-lg-2">
                                <label class="form-label fw-semibold">년도</label>
                                <select class="form-select" id="searchAttdYear">
                                    <option value="">선택</option>
                                    <option value="2024">2024</option>
                                    <option value="2025">2025</option>
                                </select>
                            </div>
                            <div class="col-md-6 col-lg-2">
                                <label class="form-label fw-semibold">월</label>
                                <select class="form-select" id="searchAttdMonth">
                                    <option value="">선택</option>
                                    <option value="1">1월</option>
                                    <option value="2">2월</option>
                                    <option value="3">3월</option>
                                    <option value="4">4월</option>
                                    <option value="5">5월</option>
                                    <option value="6">6월</option>
                                    <option value="7">7월</option>
                                    <option value="8">8월</option>
                                    <option value="9">9월</option>
                                    <option value="10">10월</option>
                                    <option value="11">11월</option>
                                    <option value="12">12월</option>
                                </select>
                            </div>
                            <div class="col-md-6 col-lg-2">
                                <label class="form-label fw-semibold">직책</label>
                                <select class="form-select" id="searchGradeIdx">
                                    <option value="">전체</option>
                                    <option value="사원">사원</option>
                                    <option value="대리">대리</option>
                                    <option value="과장">과장</option>
                                    <option value="차장">차장</option>
                                    <option value="부장">부장</option>
                                </select>
                            </div>
                            <div class="col-md-6 col-lg-4 d-flex align-items-end gap-2">
                                <button type="button" class="btn btn-primary flex-fill" id="searchBtn">
                                    <i class="bi bi-search"></i> 조회
                                </button>
                                <button type="reset" class="btn btn-outline-secondary flex-fill">
                                    <i class="bi bi-arrow-clockwise"></i> 초기화
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- 결과 요약 -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-2">
                                <h6 class="text-muted mb-1">총 직원</h6>
                                <h4 class="mb-0 fw-bold">2명</h4>
                            </div>
                            <div class="col-md-2">
                                <h6 class="text-muted mb-1">정상근무</h6>
                                <h4 class="mb-0 fw-bold text-success">39일</h4>
                            </div>
                            <div class="col-md-2">
                                <h6 class="text-muted mb-1">지각</h6>
                                <h4 class="mb-0 fw-bold text-warning">1회</h4>
                            </div>
                            <div class="col-md-2">
                                <h6 class="text-muted mb-1">조퇴</h6>
                                <h4 class="mb-0 fw-bold text-info">0회</h4>
                            </div>
                            <div class="col-md-2">
                                <h6 class="text-muted mb-1">결근</h6>
                                <h4 class="mb-0 fw-bold text-danger">0회</h4>
                            </div>
                            <div class="col-md-2">
                                <h6 class="text-muted mb-1">휴가</h6>
                                <h4 class="mb-0 fw-bold text-primary">1일</h4>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 근태 리스트 -->
                <div class="card">
                    <div class="card-header bg-white border-bottom">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0"><i class="bi bi-table me-2"></i>근태 현황</h5>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-success btn-sm">
                                    <i class="bi bi-file-earmark-excel"></i> Excel
                                </button>
                                <button class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-printer"></i> 인쇄
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="text-center">사번</th>
                                        <th class="text-center">사원명</th>
                                        <th class="text-center">부서</th>
                                        <th class="text-center">직책</th>
                                        <th class="text-center">총근무일수</th>
                                        <th class="text-center">정상근무</th>
                                        <th class="text-center">초과근무</th>
                                        <th class="text-center">지각</th>
                                        <th class="text-center">조퇴</th>
                                        <th class="text-center">결근</th>
                                        <th class="text-center">휴가</th>
                                        <th class="text-center">수정일자</th>
                                    </tr>
                                </thead>
                                <tbody id="empListBody">
                                    <tr data-bs-toggle="collapse" data-bs-target="#detailRow1" aria-expanded="false"
                                        class="cursor-pointer">
                                        <td class="text-center">EMP001</td>
                                        <td class="text-center fw-semibold">홍길동</td>
                                        <td class="text-center">인사부</td>
                                        <td class="text-center">과장</td>
                                        <td class="text-center">20일</td>
                                        <td class="text-center"><span class="badge bg-success">19일</span></td>
                                        <td class="text-center">2시간</td>
                                        <td class="text-center"><span class="badge bg-warning">1회</span></td>
                                        <td class="text-center">0회</td>
                                        <td class="text-center">0회</td>
                                        <td class="text-center">1일</td>
                                        <td class="text-center text-muted">2025-06-15</td>
                                    </tr>
                                    <tr class="collapse" id="detailRow1">
                                        <td colspan="12" class="p-0">
                                            <div class="border-top bg-light p-4">
                                                <div class="row g-4">
                                                    <div class="col-md-4">
                                                        <div class="card border-0 shadow-sm">
                                                            <div class="card-header bg-primary text-white">
                                                                <h6 class="card-title mb-0">
                                                                    <i class="bi bi-person-circle me-2"></i>사원 정보
                                                                </h6>
                                                            </div>
                                                            <div class="card-body">
                                                                <div class="row g-2">
                                                                    <div class="col-12">
                                                                        <div class="d-flex justify-content-between">
                                                                            <span class="text-muted">사원명:</span>
                                                                            <span class="fw-semibold">홍길동</span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <div class="d-flex justify-content-between">
                                                                            <span class="text-muted">년월:</span>
                                                                            <span class="fw-semibold">2024년 06월</span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <div class="d-flex justify-content-between">
                                                                            <span class="text-muted">부서명:</span>
                                                                            <span class="fw-semibold">본사 → 인사부</span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <div class="d-flex justify-content-between">
                                                                            <span class="text-muted">정규 근무일수:</span>
                                                                            <span class="fw-semibold">20일</span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <div class="d-flex justify-content-between">
                                                                            <span class="text-muted">직책:</span>
                                                                            <span class="fw-semibold">과장</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-8">
                                                        <div class="card border-0 shadow-sm">
                                                            <div
                                                                class="card-header bg-white d-flex justify-content-between align-items-center">
                                                                <h6 class="card-title mb-0">
                                                                    <i class="bi bi-calendar-check me-2"></i>상세 근태 현황
                                                                </h6>
                                                                <button class="btn btn-success btn-sm"
                                                                    data-bs-toggle="modal" data-bs-target="#editModal">
                                                                    <i class="bi bi-pencil"></i> 수정
                                                                </button>
                                                            </div>
                                                            <div class="card-body p-0">
                                                                <div class="table-responsive">
                                                                    <table class="table table-sm mb-0">
                                                                        <thead class="table-light">
                                                                            <tr>
                                                                                <th class="text-center">날짜</th>
                                                                                <th class="text-center">근무상태</th>
                                                                                <th class="text-center">출근시간</th>
                                                                                <th class="text-center">퇴근시간</th>
                                                                                <th class="text-center">총 근무시간</th>
                                                                                <th class="text-center">특이사항</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr>
                                                                                <td class="text-center">06-01</td>
                                                                                <td class="text-center">
                                                                                    <span
                                                                                        class="badge bg-success">정상근무</span>
                                                                                </td>
                                                                                <td class="text-center">9:00</td>
                                                                                <td class="text-center">18:00</td>
                                                                                <td class="text-center">9시간</td>
                                                                                <td class="text-center text-muted">-
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="text-center">06-02</td>
                                                                                <td class="text-center">
                                                                                    <span
                                                                                        class="badge bg-warning">지각</span>
                                                                                </td>
                                                                                <td class="text-center">9:45</td>
                                                                                <td class="text-center">18:00</td>
                                                                                <td class="text-center">8시간 15분</td>
                                                                                <td class="text-center text-warning">지각
                                                                                    1회</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="text-center">06-03</td>
                                                                                <td class="text-center">
                                                                                    <span
                                                                                        class="badge bg-success">정상근무</span>
                                                                                </td>
                                                                                <td class="text-center">8:55</td>
                                                                                <td class="text-center">18:00</td>
                                                                                <td class="text-center">9시간 5분</td>
                                                                                <td class="text-center text-muted">-
                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="d-flex justify-content-end mt-3">
                                                            <button class="btn btn-outline-secondary btn-sm"
                                                                data-bs-toggle="collapse" data-bs-target="#detailRow1">
                                                                <i class="bi bi-chevron-up"></i> 닫기
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr data-bs-toggle="collapse" data-bs-target="#detailRow2" aria-expanded="false"
                                        class="cursor-pointer">
                                        <td class="text-center">EMP002</td>
                                        <td class="text-center fw-semibold">홍윤희</td>
                                        <td class="text-center">영업부</td>
                                        <td class="text-center">대리</td>
                                        <td class="text-center">20일</td>
                                        <td class="text-center"><span class="badge bg-success">20일</span></td>
                                        <td class="text-center">1시간</td>
                                        <td class="text-center">0회</td>
                                        <td class="text-center">0회</td>
                                        <td class="text-center">0회</td>
                                        <td class="text-center">0일</td>
                                        <td class="text-center text-muted">-</td>
                                    </tr>
                                    <tr class="collapse" id="detailRow2">
                                        <td colspan="12" class="p-0">
                                            <div class="border-top bg-light p-4">
                                                <div class="row g-4">
                                                    <div class="col-md-4">
                                                        <div class="card border-0 shadow-sm">
                                                            <div class="card-header bg-primary text-white">
                                                                <h6 class="card-title mb-0">
                                                                    <i class="bi bi-person-circle me-2"></i>사원 정보
                                                                </h6>
                                                            </div>
                                                            <div class="card-body">
                                                                <div class="row g-2">
                                                                    <div class="col-12">
                                                                        <div class="d-flex justify-content-between">
                                                                            <span class="text-muted">사원명:</span>
                                                                            <span class="fw-semibold">홍윤희</span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <div class="d-flex justify-content-between">
                                                                            <span class="text-muted">년월:</span>
                                                                            <span class="fw-semibold">2024년 06월</span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <div class="d-flex justify-content-between">
                                                                            <span class="text-muted">부서명:</span>
                                                                            <span class="fw-semibold">본사 → 영업부</span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <div class="d-flex justify-content-between">
                                                                            <span class="text-muted">정규 근무일수:</span>
                                                                            <span class="fw-semibold">20일</span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <div class="d-flex justify-content-between">
                                                                            <span class="text-muted">직책:</span>
                                                                            <span class="fw-semibold">대리</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-8">
                                                        <div class="card border-0 shadow-sm">
                                                            <div
                                                                class="card-header bg-white d-flex justify-content-between align-items-center">
                                                                <h6 class="card-title mb-0">
                                                                    <i class="bi bi-calendar-check me-2"></i>상세 근태 현황
                                                                </h6>
                                                                <button class="btn btn-success btn-sm"
                                                                    data-bs-toggle="modal" data-bs-target="#editModal">
                                                                    <i class="bi bi-pencil"></i> 수정
                                                                </button>
                                                            </div>
                                                            <div class="card-body p-0">
                                                                <div class="table-responsive">
                                                                    <table class="table table-sm mb-0">
                                                                        <thead class="table-light">
                                                                            <tr>
                                                                                <th class="text-center">날짜</th>
                                                                                <th class="text-center">근무상태</th>
                                                                                <th class="text-center">출근시간</th>
                                                                                <th class="text-center">퇴근시간</th>
                                                                                <th class="text-center">총 근무시간</th>
                                                                                <th class="text-center">특이사항</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr>
                                                                                <td class="text-center">06-01</td>
                                                                                <td class="text-center">
                                                                                    <span
                                                                                        class="badge bg-success">정상근무</span>
                                                                                </td>
                                                                                <td class="text-center">8:50</td>
                                                                                <td class="text-center">18:00</td>
                                                                                <td class="text-center">9시간 10분</td>
                                                                                <td class="text-center text-muted">-
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="text-center">06-02</td>
                                                                                <td class="text-center">
                                                                                    <span
                                                                                        class="badge bg-success">정상근무</span>
                                                                                </td>
                                                                                <td class="text-center">9:00</td>
                                                                                <td class="text-center">18:00</td>
                                                                                <td class="text-center">9시간</td>
                                                                                <td class="text-center text-muted">-
                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="d-flex justify-content-end mt-3">
                                                            <button class="btn btn-outline-secondary btn-sm"
                                                                data-bs-toggle="collapse" data-bs-target="#detailRow2">
                                                                <i class="bi bi-chevron-up"></i> 닫기
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 페이징 -->
                <div class="d-flex justify-content-center mt-4">
                    <nav aria-label="Page navigation">
                        <ul class="pagination">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <!-- 수정 모달 -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-pencil-square me-2"></i>근태 상세 수정
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" role="alert">
                        <i class="bi bi-info-circle me-2"></i>
                        셀을 더블클릭하여 수정할 수 있습니다.
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm align-middle text-center" id="editTable">
                            <thead class="table-light">
                                <tr>
                                    <th>날짜</th>
                                    <th>근무상태</th>
                                    <th>출근시간</th>
                                    <th>퇴근시간</th>
                                    <th>총 근무시간</th>
                                    <th>특이사항</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>06-01</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">정상근무</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">9:00</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">18:00</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">9시간</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">-</td>
                                </tr>
                                <tr>
                                    <td>06-02</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">지각</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">9:45</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">18:00</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">8시간 15분</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">지각 1회</td>
                                </tr>
                                <tr>
                                    <td>06-03</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">정상근무</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">8:55</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">18:00</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">9시간 5분</td>
                                    <td ondblclick="editCell(this)" class="cursor-pointer">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary">
                        <i class="bi bi-check-lg me-2"></i>저장
                    </button>
                    <button class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-lg me-2"></i>닫기
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(function () {
            let currentPage = 1;
            let currentDetailEmpIdx = null;

            // 1) 최초 로딩, 검색은 항상 1페이지부터
            loadEmpList(1);

            $("#searchBtn").on("click", function () {
                loadEmpList(1);
            });

            // 2) 페이징 클릭 처리
            $("#paginationArea").on("click", ".page-link", function () {
                const p = parseInt($(this).data("page"), 10);
                if (p >= 1 && p !== currentPage) {
                    loadEmpList(p);
                }
            });

            // 3) 리스트 클릭 → 상세 토글 + 로드
            $("#empListBody").on("click", "tr.tr-item", function () {
                const target = $(this).attr("data-bs-target");
                currentDetailEmpIdx = $(this).data("emp-idx");

                // 다른 열려있는 건 닫고
                $("#empListBody .collapse").not(target).collapse("hide");
                // 자신 토글
                $(target).collapse("toggle");

                loadEmpDetail(currentDetailEmpIdx);
            });

            function loadEmpList(page = 1) {
                currentPage = page;

                const searchData = {
                    empName: $('input[name="SearchEmpName"]').val(),  // id 대신 name으로 가져오도록
                    empType: $("#searchEmpType").val(),
                    deptUpIdx: $("#searchDeptUpIdx").val(),
                    deptDownIdx: $("#searchDeptDownIdx").val(),
                    gradeIdx: $("#searchGradeIdx").val(),
                    attdYear: $("#searchAttdYear").val(),
                    attdMonth: $("#searchAttdMonth").val(),
                };

                const queryString = $.param(searchData);

                $.ajax({
                    type: "GET",
                    url: `/hr/attd/mgr/list?${queryString}&page=${page}`,
                    success: function (res) {
                        if (res.head.res_code === "200") {
                            const data = res.body;
                            renderEmpListBody(data.emps);
                            renderPagination(data.page, data.pageSize, data.total);
                        } else {
                            Swal.fire("실패", res.body, "error");
                        }
                    },
                    error: function () {
                        Swal.fire("오류", "서버와 통신 중 오류가 발생했습니다.", "error");
                    }
                });
            }

            function loadEmpDetail(empIdx) {
                // 선택된 년·월을 실제 선택값으로
                const year = $("#searchAttdYear").val() || new Date().getFullYear();
                const month = $("#searchAttdMonth").val().padStart(2, "0") || String(new Date().getMonth() + 1).padStart(2, "0");

                $.ajax({
                    type: "GET",
                    url: `/hr/attd/mgr/detail?empIdx=${empIdx}&year=${year}&month=${month}`,
                    success: function (res) {
                        if (res.head.res_code === "200") {
                            renderEmpDetail(res.body);
                        } else {
                            Swal.fire("실패", res.body, "error");
                        }
                    },
                    error: function () {
                        Swal.fire("오류", "서버와 통신 중 오류가 발생했습니다.", "error");
                    }
                });
            }

            function renderEmpDetail(attds) {
                // collapse row id를 empIdx 기반으로 고유하게
                const rowId = `detailRow-${currentDetailEmpIdx}`;
                // 기존에 있으면 제거
                $(`#${rowId}`).remove();

                let html = `
        <tr class="collapse bg-light" id="${rowId}">
          <td colspan="12" class="p-0">
            <div class="border-top bg-light p-4">
              <div class="row g-4">
                <div class="col-md-4">
                  <!-- 사원 정보 카드 (필요시 동적으로 채워도 됩니다) -->
                </div>
                <div class="col-md-8">
                  <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                      <h6 class="card-title mb-0"><i class="bi bi-calendar-check me-2"></i>상세 근태 현황</h6>
                      <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#editModal">
                        <i class="bi bi-pencil"></i> 수정
                      </button>
                    </div>
                    <div class="card-body p-0">
                      <div class="table-responsive">
                        <table class="table table-sm mb-0 text-center">
                          <thead class="table-light">
                            <tr>
                              <th>날짜</th><th>근무상태</th><th>출근시간</th><th>퇴근시간</th>
                              <th>총 근무시간</th><th>특이사항</th>
                            </tr>
                          </thead>
                          <tbody>`;
                attds.forEach(item => {
                    html += `
            <tr>
              <td>${item.date}</td>
              <td>${item.status}</td>
              <td>${item.start}</td>
              <td>${item.end}</td>
              <td>${item.totalTime}</td>
              <td>${item.note || '-'}</td>
            </tr>`;
                });
                html += `
                          </tbody>
                        </table>
                      </div>
                      <div class="d-flex justify-content-end mt-3">
                        <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="collapse" data-bs-target="#${rowId}">
                          <i class="bi bi-chevron-up"></i> 닫기
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </td>
        </tr>`;

                // 해당 사원 행 바로 아래에 삽입
                $(`tr.tr-item[data-emp-idx="${currentDetailEmpIdx}"]`).after(html);
            }

            function renderEmpListBody(emps) {
                const $body = $("#empListBody").empty();
                emps.forEach((item, i) => {
                    $body.append(`
            <tr class="tr-item" data-bs-toggle="collapse" data-bs-target="#detailRow-${item.empIdx}"
                style="cursor:pointer;" data-emp-idx="${item.empIdx}">
              <td>${i + 1}</td>
              <td>${item.empName}</td>
              <td>${item.deptName}</td>
              <td>${item.grdName}</td>
              <td>${item.totalDay}</td>
              <td>${item.workDay}</td>
              <td>${item.nightHours}</td>
              <td>${item.lateCount}</td>
              <td>${item.leaveEarlyCount}</td>
              <td>${item.abCount}</td>
              <td>${item.usedLeaveDay}</td>
              <td>${item.lastModDate || '-'}</td>
            </tr>`);
                });
            }

            function renderPagination(page, pageSize, total) {
                const totalPages = Math.ceil(total / pageSize);
                const $pg = $("#paginationArea").empty();

                // 이전
                $pg.append(`
          <li class="page-item ${page === 1 ? "disabled" : ""}">
            <span class="page-link" data-page="${page - 1}">이전</span>
          </li>`);

                // 1 ~ totalPages
                for (let i = 1; i <= totalPages; i++) {
                    $pg.append(`
              <li class="page-item ${i === page ? "active" : ""}">
                <span class="page-link" data-page="${i}">${i}</span>
              </li>`);
                }

                // 다음
                $pg.append(`
          <li class="page-item ${page === totalPages ? "disabled" : ""}">
            <span class="page-link" data-page="${page + 1}">다음</span>
          </li>`);
            }

            function loadUpDept() {
                $.ajax({
                    type: "",
                    url: "",
                    success: function (res) {
                        if (res.head.res_code === "200") {
                            const data = res.body;

                        } else {
                            Swal.fire("실패", res.body, "error");
                        }
                    },
                    error: function (xhr, status, err) {
                        console.error(err);
                        Swal.fire("오류", "서버와 통신 중 오류가 발생했습니다.", "error");
                    }
                });
            }

            function loadYears() {
                $.ajax({
                    type: "",
                    url: "",
                    success: function (res) {
                        if (res.head.res_code === "200") {
                            const data = res.body;

                        } else {
                            Swal.fire("실패", res.body, "error");
                        }
                    },
                    error: function (xhr, status, err) {
                        console.error(err);
                        Swal.fire("오류", "서버와 통신 중 오류가 발생했습니다.", "error");
                    }
                });
            }

            function loadMonth() {
                $.ajax({
                    type: "",
                    url: "",
                    success: function (res) {
                        if (res.head.res_code === "200") {
                            const data = res.body;

                        } else {
                            Swal.fire("실패", res.body, "error");
                        }
                    },
                    error: function (xhr, status, err) {
                        console.error(err);
                        Swal.fire("오류", "서버와 통신 중 오류가 발생했습니다.", "error");
                    }
                });
            }
            //6. 셀 더블클릭 수정 함수
            window.editCell = function (td) {
                const $td = $(td);
                if ($td.find('input').length) return; // 이미 편집 모드면 무시
                const old = $td.text().trim();
                const $input = $('<input type="text" class="form-control form-control-sm">').val(old);
                $td.empty().append($input);
                $input.focus();

                // blur 또는 Enter 시 저장
                $input.on('blur keydown', function (e) {
                    if (e.type === 'blur' || (e.type === 'keydown' && e.key === 'Enter')) {
                        const val = $input.val().trim() || old;
                        $td.empty().text(val);
                    }
                });
            };
        });
    </script>
</div>