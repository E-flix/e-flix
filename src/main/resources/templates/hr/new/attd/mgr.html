<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{common/layouts/default}">
<!-- ============================================
  - ÏûëÏÑ±Ïûê   : ÍπÄÏñ¥ÏßÑ
  - ÏµúÏ¥àÏûëÏÑ± : 2025-06-18
  - ÏÑ§Î™Ö     : Í∑ºÌÉú Í¥ÄÎ¶¨ÌôîÎ©¥ (Í¥ÄÎ¶¨Ïûê)
  -----------------------------------------------
  [ Î≥ÄÍ≤Ω Ïù¥Î†• ]
  - 2025-06-18 (ÍπÄÏñ¥ÏßÑ): title Î∞è ÎÇ¥Ïö© Ï∂îÍ∞Ä
  - 2025-06-19 (ÍπÄÏñ¥ÏßÑ): layout Íµ¨ÏÑ±
============================================ -->

<head>
    <title>Í∑ºÌÉúÍ¥ÄÎ¶¨</title>
</head>
<div layout:fragment="content">
    <div id="attdManager">

        <!-- ÌïÑÌÑ∞ ÏòÅÏó≠ -->
        <form class="row g-3 align-items-end mb-4 p-4 border bg-light rounded">
            <div class="col-md-6 col-lg-3">
                <label class="form-label fw-semibold">ÏÇ¨ÏõêÎ™Ö</label>
                <input type="text" class="form-control" placeholder="Í≤ÄÏÉâÏñ¥ ÏûÖÎ†•" name="SearchEmpName">
            </div>
            <div class="col-md-6 col-lg-3">
                <label class="form-label fw-semibold">Í∑ºÎ¨¥ÏÉÅÌÉú</label>
                <select class="form-select" id="searchEmpType">
                    <option value="">Ï†ÑÏ≤¥</option>
                    <option value="Ï†ïÏÉÅ">Ï†ïÏÉÅÍ∑ºÎ¨¥</option>
                    <option value="ÏßÄÍ∞Å">ÏßÄÍ∞Å</option>
                    <option value="Ï°∞Ìá¥">Ï°∞Ìá¥</option>
                    <option value="Í≤∞Í∑º">Í≤∞Í∑º</option>
                </select>
            </div>
            <div class="col-md-6 col-lg-3">
                <label class="form-label fw-semibold">Î∂ÄÏÑú</label>
                <select name="deptUpIdx" class="form-select" id="searchDeptUpIdx">
                    <option value="">Ï†ÑÏ≤¥</option>
                    <option value="Î≥∏ÏÇ¨">Î≥∏ÏÇ¨</option>
                </select>
            </div>
            <div class="col-md-6 col-lg-3">
                <label class="form-label fw-semibold">ÏÉÅÏÑ∏ Î∂ÄÏÑú</label>
                <select name="deptIdx" class="form-select" id="searchDeptDownIdx">
                    <option value="">Ï†ÑÏ≤¥</option>
                    <option value="Ïù∏ÏÇ¨Î∂Ä">Ïù∏ÏÇ¨Î∂Ä</option>
                    <option value="ÏòÅÏóÖÎ∂Ä">ÏòÅÏóÖÎ∂Ä</option>
                </select>
            </div>
            <div class="col-md-6 col-lg-2">
                <label class="form-label fw-semibold">ÎÖÑÎèÑ</label>
                <select class="form-select" id="searchAttdYear">
                    <option value="">ÏÑ†ÌÉù</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                </select>
            </div>
            <div class="col-md-6 col-lg-2">
                <label class="form-label fw-semibold">Ïõî</label>
                <select class="form-select" id="searchAttdMonth">
                    <option value="">ÏÑ†ÌÉù</option>
                </select>
            </div>
            <div class="col-md-6 col-lg-2">
                <label class="form-label fw-semibold">ÏßÅÏ±Ö</label>
                <select class="form-select" id="searchGradeIdx">
                    <option value="">Ï†ÑÏ≤¥</option>
                </select>
            </div>
            <div class="col-md-6 col-lg-4 d-flex align-items-end gap-2">
                <button type="button" class="btn btn-primary flex-fill" id="searchBtn">
                    <i class="bi bi-search"></i> Ï°∞Ìöå
                </button>
                <button type="reset" class="btn btn-outline-secondary flex-fill">
                    <i class="bi bi-arrow-clockwise"></i> Ï¥àÍ∏∞Ìôî
                </button>
            </div>
        </form>

        <!-- ÏÉÅÎã® Í∑ºÌÉú Î¶¨Ïä§Ìä∏ -->
        <div class="table-responsive mb-5">
            <table class="table table-bordered table-hover align-middle text-center">
                <thead class="table-light">
                    <tr>
                        <th>ÏÇ¨Î≤à</th>
                        <th>ÏÇ¨ÏõêÎ™Ö</th>
                        <th>Î∂ÄÏÑú</th>
                        <th>ÏßÅÏ±Ö</th>
                        <th>Ï¥ùÍ∑ºÎ¨¥ÏùºÏàò</th>
                        <th>Ï†ïÏÉÅÍ∑ºÎ¨¥</th>
                        <th>Ï¥àÍ≥ºÍ∑ºÎ¨¥</th>
                        <th>ÏßÄÍ∞Å</th>
                        <th>Ï°∞Ìá¥</th>
                        <th>Í≤∞Í∑º</th>
                        <th>Ìú¥Í∞Ä</th>
                        <th>ÏàòÏ†ïÏùºÏûê</th>
                    </tr>
                </thead>
                <tbody id="empListBody">
                    <tr data-bs-toggle="collapse" data-bs-target="#detailRow1" aria-expanded="false"
                        style="cursor:pointer;">
                        <td>1</td>
                        <td>ÌôçÍ∏∏Îèô</td>
                        <td>Ïù∏ÏÇ¨Î∂Ä</td>
                        <td>Í≥ºÏû•</td>
                        <td>20Ïùº</td>
                        <td>19Ïùº</td>
                        <td>2ÏãúÍ∞Ñ</td>
                        <td>1Ìöå</td>
                        <td>0Ìöå</td>
                        <td>0Ìöå</td>
                        <td>1Ïùº</td>
                        <td>2025-06-15</td>
                    </tr>
                    <tr class="collapse bg-light" id="detailRow1">
                        <td colspan="12">
                            <!-- ÏÉÅÏÑ∏ ÏòÅÏó≠ (ÏïÑÎûòÏóêÏÑú Î≥ÑÎèÑ ÏûëÏÑ±) -->
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h6 class="card-title fw-bold mb-3">üìã ÏÇ¨Ïõê Ï†ïÎ≥¥</h6>
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item"><strong>ÏÇ¨ÏõêÎ™Ö:</strong> ÌôçÍ∏∏Îèô</li>
                                                <li class="list-group-item"><strong>ÎÖÑÏõî:</strong> 2024ÎÖÑ 06Ïõî</li>
                                                <li class="list-group-item"><strong>Î∂ÄÏÑúÎ™Ö:</strong> A01 Î≥∏ÏÇ¨ ‚Üí Ïù∏ÏÇ¨Î∂Ä</li>
                                                <li class="list-group-item"><strong>Ï†ïÍ∑ú Í∑ºÎ¨¥ÏùºÏàò:</strong> 20Ïùº</li>
                                                <li class="list-group-item"><strong>ÏßÅÏ±Ö:</strong> Í≥ºÏû•</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="d-flex justify-content-end mb-2">
                                        <button class="btn btn-success btn-sm me-2" data-bs-toggle="modal"
                                            data-bs-target="#editModal">ÏàòÏ†ï</button>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-sm table-bordered text-center mb-0">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>ÎÇ†Ïßú</th>
                                                    <th>Í∑ºÎ¨¥ÏÉÅÌÉú</th>
                                                    <th>Ï∂úÍ∑ºÏãúÍ∞Ñ</th>
                                                    <th>Ìá¥Í∑ºÏãúÍ∞Ñ</th>
                                                    <th>Ï¥ù Í∑ºÎ¨¥ÏãúÍ∞Ñ</th>
                                                    <th>ÌäπÏù¥ÏÇ¨Ìï≠</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>06-01</td>
                                                    <td>Ï†ïÏÉÅÍ∑ºÎ¨¥</td>
                                                    <td>9:00</td>
                                                    <td>18:00</td>
                                                    <td>9ÏãúÍ∞Ñ</td>
                                                    <td>-</td>
                                                </tr>
                                                <tr>
                                                    <td>06-02</td>
                                                    <td>ÏßÄÍ∞Å</td>
                                                    <td>9:45</td>
                                                    <td>18:00</td>
                                                    <td>8ÏãúÍ∞Ñ 15Î∂Ñ</td>
                                                    <td>ÏßÄÍ∞Å 1Ìöå</td>
                                                </tr>
                                                <!-- ... -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="d-flex justify-content-end mt-2">
                                        <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="collapse"
                                            data-bs-target="#detailRow1">Îã´Í∏∞</button>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <!-- Îëê Î≤àÏß∏ ÏÇ¨Ïõê -->
                    <tr>
                        <td>2</td>
                        <td>ÌôçÏú§Ìù¨</td>
                        <td>ÏòÅÏóÖÎ∂Ä</td>
                        <td>ÎåÄÎ¶¨</td>
                        <td>20Ïùº</td>
                        <td>20Ïùº</td>
                        <td>1ÏãúÍ∞Ñ</td>
                        <td>0Ìöå</td>
                        <td>0Ìöå</td>
                        <td>0Ìöå</td>
                        <td>0Ïùº</td>
                        <td>-</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ÏàòÏ†ï Î™®Îã¨ -->
        <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Í∑ºÌÉú ÏÉÅÏÑ∏ ÏàòÏ†ï</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Îã´Í∏∞"></button>
                    </div>
                    <div class="modal-body">
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm align-middle text-center" id="editTable">
                                <thead class="table-light">
                                    <tr>
                                        <th>ÎÇ†Ïßú</th>
                                        <th>Í∑ºÎ¨¥ÏÉÅÌÉú</th>
                                        <th>Ï∂úÍ∑ºÏãúÍ∞Ñ</th>
                                        <th>Ìá¥Í∑ºÏãúÍ∞Ñ</th>
                                        <th>Ï¥ù Í∑ºÎ¨¥ÏãúÍ∞Ñ</th>
                                        <th>ÌäπÏù¥ÏÇ¨Ìï≠</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>06-01</td>
                                        <td ondblclick="editCell(this)">Ï†ïÏÉÅÍ∑ºÎ¨¥</td>
                                        <td ondblclick="editCell(this)">9:00</td>
                                        <td ondblclick="editCell(this)">18:00</td>
                                        <td ondblclick="editCell(this)">9ÏãúÍ∞Ñ</td>
                                        <td ondblclick="editCell(this)">-</td>
                                    </tr>
                                    <!-- ... -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary">Ï†ÄÏû•</button>
                        <button class="btn btn-secondary" data-bs-dismiss="modal">Îã´Í∏∞</button>
                    </div>
                </div>
            </div>
        </div>
        <script>
            $(function () {
                let currentPage = 1;
                loadEmpList(1);


                $("#searchBtn").on("click", function () {
                    loadEmpList();
                });

                function loadEmpList(page = 1) {
                    currentPage = page;

                    const searchData = {
                        empName: $("#searchEmpName").val(),
                        empType: $("#searchEmpType").val(),
                        deptUpIdx: $("#searchDeptUpIdx").val(),
                        deptDownIdx: $("#searchDeptDownIdx").val(),
                        gradeIdx: $("#searchGradeIdx").val(),
                        attdYear: $("#searchAttdYear").val(),
                        attdMonth: $("#searchAttdMonth").val(),
                    }

                    const queryString = $.param(searchData);

                    $.ajax({
                        type: "GET",
                        url: `/hr/attd/mgr/list?${queryString}&page=${page}`,
                        success: function (res) {
                            if (res.head.res_code === "200") {
                                const data = res.body;

                                renderEmpListBody(data.emps);
                                renderPagination(data.page, data.pageSize, data.total);
                            } else {
                                Swal.fire("Ïã§Ìå®", res.body, "error");
                            }
                        },
                        error: function (xhr, status, err) {
                            console.error(err);
                            Swal.fire("Ïò§Î•ò", "ÏÑúÎ≤ÑÏôÄ ÌÜµÏã† Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.", "error");
                        }
                    });
                }

                function renderEmpListBody(emps) {
                    const $empListBody = $("#empListBody");
                    $empListBody.empty();
                    let html = "";
                    $.each(emps, function (i, item) {
                        html += `
                         <tr data-bs-toggle="collapse" data-bs-target="#detailRow1" aria-expanded="false" style="cursor:pointer;">
                            <td>${i}</td>
                            <td>${item.empName}</td>
                            <td>${item.deptName}</td>
                            <td>${item.grdName}</td>
                            <td>${item.totalDay}</td>
                            <td>${item.workDay}</td>
                            <td>${item.nightHours}</td>
                            <td>${item.lateCount}</td>
                            <td>${item.leaveEarlyCount}</td>
                            <td>${item.abCount}</td>
                            <td>${item.usedLeaveDay}</td>
                            <td>${item.lastModDate}</td>
                        </tr>
                    `;
                    });
                    $empListBody.html(html);
                }

                function renderPagination(page, pageSize, total) {
                    const $totalPages = Math.ceil(total / pageSize);
                    const $pagination = $("#paginationArea");

                    $pagination.empty();
                    $pagination.append(`
                    <li class="page-item ${page === 1 ? 'disabled' : ''}">
                        <span class="page-link" data-page="${page - 1}">Ïù¥Ï†Ñ</span>
                    </li>
                `);

                    for (let i = 0; i <= totalPages; i++) {
                        $pagination.append(`
                        <li class="page-item ${i === page ? 'active' : ''}">
                            <span class="page-link" data-page="${i}">${i}</span>
                        </li>
                    `);
                    }

                    $pagination.append(`
                    <li class="page-item ${page === totalPages ? 'disabled' : ''}">
                        <a class="page-link" data-page="${page + 1}">Îã§Ïùå</a>
                    </li>
                `);
                }

                function loadUpDept() {
                    $.ajax({
                        type: "",
                        url: "",
                        success: function (res) {
                            if (res.head.res_code === "200") {
                                const data = res.body;

                            } else {
                                Swal.fire("Ïã§Ìå®", res.body, "error");
                            }
                        },
                        error: function (xhr, status, err) {
                            console.error(err);
                            Swal.fire("Ïò§Î•ò", "ÏÑúÎ≤ÑÏôÄ ÌÜµÏã† Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.", "error");
                        }
                    });
                }

                function loadYears() {
                    $.ajax({
                        type: "",
                        url: "",
                        success: function (res) {
                            if (res.head.res_code === "200") {
                                const data = res.body;

                            } else {
                                Swal.fire("Ïã§Ìå®", res.body, "error");
                            }
                        },
                        error: function (xhr, status, err) {
                            console.error(err);
                            Swal.fire("Ïò§Î•ò", "ÏÑúÎ≤ÑÏôÄ ÌÜµÏã† Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.", "error");
                        }
                    });
                }

                function loadMonth() {
                    $.ajax({
                        type: "",
                        url: "",
                        success: function (res) {
                            if (res.head.res_code === "200") {
                                const data = res.body;

                            } else {
                                Swal.fire("Ïã§Ìå®", res.body, "error");
                            }
                        },
                        error: function (xhr, status, err) {
                            console.error(err);
                            Swal.fire("Ïò§Î•ò", "ÏÑúÎ≤ÑÏôÄ ÌÜµÏã† Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.", "error");
                        }
                    });
                }
            });
        </script>
        <!-- Ïä§ÌÅ¨Î¶ΩÌä∏ -->
        <script>
            const coIdx = "co-201"
            function showDetail(name) {
                document.getElementById('detailSection').style.display = 'block';
                // Ï∂îÍ∞ÄÏ†ÅÏúºÎ°ú ÏÑ†ÌÉùÌïú ÏÇ¨Ïõê Îç∞Ïù¥ÌÑ∞Î°ú Í∞±Ïã†Ìï† Ïàò ÏûàÏùå
            }

            function hideDetail() {
                document.getElementById('detailSection').style.display = 'none';
            }

            function editCell(cell) {
                const originalText = cell.innerText;
                const input = document.createElement("input");
                input.type = "text";
                input.value = originalText;
                input.classList.add("form-control");
                input.onblur = function () {
                    cell.innerText = input.value || originalText;
                };
                cell.innerText = "";
                cell.appendChild(input);
                input.focus();
            }

            $("#searchBtn").on("click", function () {
                const query = {
                    empName: $("#empName").val(),
                }
                $.ajax({
                    url: "/hr/am/search",
                    type: "GET",
                    data: query,
                    dataType: 'json',
                    success: function (code) {
                        if (code === '200') {
                            alert('ÏÑ±Í≥µ')
                        }
                    },
                    error: function (xhr, status, err) {
                        console.error(err);
                    }
                })
            });
            function loadDept() {
                $.ajax({
                    url: "/hr/dept/list/all?coIdx=" + coIdx,
                    type: "GET",
                    success: function (res) {
                        $("#deptSelect").empty();
                        $.each(res, function (i, item) {
                            let option = `<option value="${item.deptIdx}">${item.deptName}</option>`;
                            $("#deptSelect").append(option);
                        });
                    },
                    error: function (xhr, status, err) {
                        console.error(err);
                    }
                })
            }
            $(document).ready(function () {
                loadDept();
            });
        </script>
    </div>
</div>