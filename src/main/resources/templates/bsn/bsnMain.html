<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{common/layouts/default}">
<head>
  <title>영업관리</title>
  <style>
    .card {
      transition: all 0.3s ease;
      border: none;
      box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0.3rem 2rem 0 rgba(58, 59, 69, 0.25);
    }
    
    .card-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: 600;
      border: none;
    }
    
    .menu-link {
      text-decoration: none;
      color: #5a5c69;
      font-weight: 500;
      transition: all 0.2s;
      display: block;
      padding: 8px 0;
      border-left: 3px solid transparent;
      padding-left: 12px;
    }
    
    .menu-link:hover {
      color: #4e73df;
      border-left-color: #4e73df;
      background-color: rgba(78, 115, 223, 0.05);
      text-decoration: none;
      margin-left: 5px;
    }
    
    .menu-icon {
      width: 20px;
      margin-right: 8px;
      color: #858796;
    }
    
    .menu-link:hover .menu-icon {
      color: #4e73df;
    }
    
    .main-title {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 15px;
      box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    .dashboard-card {
      background: linear-gradient(135deg, #1cc88a 0%, #13855c 100%);
    }
    
    .management-card {
      background: linear-gradient(135deg, #4e73df 0%, #224abe 100%);
    }
    
    .analytics-card {
      background: linear-gradient(135deg, #f6c23e 0%, #dda20a 100%);
    }
    
    .reports-card {
      background: linear-gradient(135deg, #e74a3b 0%, #c0392b 100%);
    }
  </style>
</head>
<div layout:fragment="content">
  <div class="container" id="bsn-main">
    
    <!-- 메인 타이틀 -->
    <div class="main-title text-center mb-5 py-4">
      <h2 class="mb-2">
        <i class="fas fa-chart-line mr-3"></i>영업관리 시스템
      </h2>
      <p class="mb-0 opacity-75">
        통합 영업 프로세스 관리 및 실시간 성과 분석
      </p>
    </div>

    <div class="row g-4">
      
      <!-- 📊 실시간 대시보드 -->
      <div class="col-md-6 col-lg-3 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-header dashboard-card text-white">
            <i class="fas fa-tachometer-alt mr-2"></i>
            실시간 대시보드
          </div>
          <div class="card-body">
            <ul class="list-unstyled mb-0">
              <li>
                <a href="/bsn/dashboard" class="menu-link">
                  <i class="fas fa-chart-area menu-icon"></i>매출 현황 대시보드
                </a>
              </li>
              <li>
                <a href="/bsn/dashboard#pipeline" class="menu-link">
                  <i class="fas fa-funnel-dollar menu-icon"></i>영업 파이프라인
                </a>
              </li>
              <li>
                <a href="/bsn/dashboard#kpi" class="menu-link">
                  <i class="fas fa-bullseye menu-icon"></i>핵심 성과 지표
                </a>
              </li>
              <li>
                <a href="/bsn/dashboard#alerts" class="menu-link">
                  <i class="fas fa-exclamation-triangle menu-icon"></i>주의사항 알림
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- 📋 영업 관리 -->
      <div class="col-md-6 col-lg-3 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-header management-card text-white">
            <i class="fas fa-tasks mr-2"></i>
            영업 관리
          </div>
          <div class="card-body">
            <ul class="list-unstyled mb-0">
              <li>
                <a href="/bsn/qot_list" class="menu-link">
                  <i class="fas fa-file-alt menu-icon"></i>견적서 관리
                </a>
              </li>
              <li>
                <a href="/bsn/order_management" class="menu-link">
                  <i class="fas fa-shopping-cart menu-icon"></i>주문서 관리
                </a>
              </li>
              <li>
                <a href="/bsn/soutbound" class="menu-link">
                  <i class="fas fa-shipping-fast menu-icon"></i>출고 관리
                </a>
              </li>
              <li>
                <a href="/bsn/customer_management" class="menu-link">
                  <i class="fas fa-users menu-icon"></i>거래처 관리
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- 📊 영업 분석 -->
      <div class="col-md-6 col-lg-3 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-header analytics-card text-white">
            <i class="fas fa-chart-pie mr-2"></i>
            영업 분석
          </div>
          <div class="card-body">
            <ul class="list-unstyled mb-0">
              <li>
                <a href="/bsn/analytics/customer" class="menu-link">
                  <i class="fas fa-user-chart menu-icon"></i>고객별 매출 분석
                </a>
              </li>
              <li>
                <a href="/bsn/analytics/product" class="menu-link">
                  <i class="fas fa-box-open menu-icon"></i>상품별 수익성 분석
                </a>
              </li>
              <li>
                <a href="/bsn/analytics/employee" class="menu-link">
                  <i class="fas fa-user-tie menu-icon"></i>영업사원 성과 분석
                </a>
              </li>
              <li>
                <a href="/bsn/analytics/trend" class="menu-link">
                  <i class="fas fa-trending-up menu-icon"></i>매출 트렌드 분석
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- 📈 리포트 -->
      <div class="col-md-6 col-lg-3 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-header reports-card text-white">
            <i class="fas fa-file-download mr-2"></i>
            리포트
          </div>
          <div class="card-body">
            <ul class="list-unstyled mb-0">
              <li>
                <a href="/bsn/reports/daily" class="menu-link">
                  <i class="fas fa-calendar-day menu-icon"></i>일별 매출 리포트
                </a>
              </li>
              <li>
                <a href="/bsn/reports/monthly" class="menu-link">
                  <i class="fas fa-calendar-alt menu-icon"></i>월별 실적 리포트
                </a>
              </li>
              <li>
                <a href="/bsn/reports/annual" class="menu-link">
                  <i class="fas fa-calendar menu-icon"></i>연간 종합 리포트
                </a>
              </li>
              <li>
                <a href="/bsn/reports/custom" class="menu-link">
                  <i class="fas fa-cog menu-icon"></i>맞춤형 리포트
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- 빠른 액션 버튼들 -->
    <div class="row mt-5">
      <div class="col-12">
        <div class="card shadow">
          <div class="card-header bg-gradient-primary text-white">
            <h6 class="mb-0">
              <i class="fas fa-rocket mr-2"></i>빠른 실행
            </h6>
          </div>
          <div class="card-body">
            <div class="row text-center">
              <div class="col-md-2 col-6 mb-3">
                <button class="btn btn-outline-primary btn-lg btn-block py-3" onclick="location.href='/bsn/qot'">
                  <i class="fas fa-plus-circle fa-2x mb-2 d-block"></i>
                  새 견적서
                </button>
              </div>
              <div class="col-md-2 col-6 mb-3">
                <button class="btn btn-outline-success btn-lg btn-block py-3" onclick="quickOrderEntry()">
                  <i class="fas fa-cart-plus fa-2x mb-2 d-block"></i>
                  빠른 주문
                </button>
              </div>
              <div class="col-md-2 col-6 mb-3">
                <button class="btn btn-outline-info btn-lg btn-block py-3" onclick="quickOutbound()">
                  <i class="fas fa-truck fa-2x mb-2 d-block"></i>
                  긴급 출고
                </button>
              </div>
              <div class="col-md-2 col-6 mb-3">
                <button class="btn btn-outline-warning btn-lg btn-block py-3" onclick="searchCustomer()">
                  <i class="fas fa-search fa-2x mb-2 d-block"></i>
                  거래처 조회
                </button>
              </div>
              <div class="col-md-2 col-6 mb-3">
                <button class="btn btn-outline-secondary btn-lg btn-block py-3" onclick="todayReport()">
                  <i class="fas fa-chart-bar fa-2x mb-2 d-block"></i>
                  오늘 실적
                </button>
              </div>
              <div class="col-md-2 col-6 mb-3">
                <button class="btn btn-outline-danger btn-lg btn-block py-3" onclick="alertSummary()">
                  <i class="fas fa-bell fa-2x mb-2 d-block"></i>
                  알림 요약
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 최근 활동 요약 -->
    <div class="row mt-4">
      <div class="col-lg-8">
        <div class="card shadow">
          <div class="card-header bg-gradient-success text-white">
            <h6 class="mb-0">
              <i class="fas fa-clock mr-2"></i>최근 활동
            </h6>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-borderless" id="recentActivities">
                <tbody>
                  <tr>
                    <td><i class="fas fa-file-alt text-primary"></i></td>
                    <td>견적서 <strong>QT-20250108-001</strong> 생성됨</td>
                    <td class="text-muted">2분 전</td>
                  </tr>
                  <tr>
                    <td><i class="fas fa-shopping-cart text-success"></i></td>
                    <td>주문서 <strong>SO-20250108-005</strong> 승인됨</td>
                    <td class="text-muted">15분 전</td>
                  </tr>
                  <tr>
                    <td><i class="fas fa-shipping-fast text-info"></i></td>
                    <td>출고 <strong>OUT-20250108-003</strong> 완료됨</td>
                    <td class="text-muted">1시간 전</td>
                  </tr>
                  <tr>
                    <td><i class="fas fa-user text-warning"></i></td>
                    <td>신규 거래처 <strong>ABC코퍼레이션</strong> 등록됨</td>
                    <td class="text-muted">3시간 전</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card shadow">
          <div class="card-header bg-gradient-info text-white">
            <h6 class="mb-0">
              <i class="fas fa-chart-line mr-2"></i>오늘의 요약
            </h6>
          </div>
          <div class="card-body">
            <div class="row no-gutters">
              <div class="col-6 text-center border-right">
                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">견적</div>
                <div class="h5 mb-0 font-weight-bold text-gray-800" id="todayQuotations">12</div>
              </div>
              <div class="col-6 text-center">
                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">주문</div>
                <div class="h5 mb-0 font-weight-bold text-gray-800" id="todayOrders">8</div>
              </div>
            </div>
            <hr>
            <div class="row no-gutters">
              <div class="col-6 text-center border-right">
                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">출고</div>
                <div class="h5 mb-0 font-weight-bold text-gray-800" id="todayOutbound">5</div>
              </div>
              <div class="col-6 text-center">
                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">매출</div>
                <div class="h5 mb-0 font-weight-bold text-gray-800" id="todaySales">1.2억</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    // 빠른 액션 함수들
    function quickOrderEntry() {
      Swal.fire({
        title: '빠른 주문 입력',
        html: `
          <div class="text-left">
            <div class="form-group">
              <label>거래처</label>
              <input id="quickCustomer" type="text" class="form-control" placeholder="거래처명 검색">
            </div>
            <div class="form-group">
              <label>품목</label>
              <input id="quickItem" type="text" class="form-control" placeholder="품목명 검색">
            </div>
            <div class="form-group">
              <label>수량</label>
              <input id="quickQty" type="number" class="form-control" value="1" min="1">
            </div>
          </div>
        `,
        showCancelButton: true,
        confirmButtonText: '주문서 생성',
        cancelButtonText: '취소',
        preConfirm: () => {
          // TODO: 빠른 주문 로직 구현
          return true;
        }
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire('준비중', '빠른 주문 기능을 준비중입니다.', 'info');
        }
      });
    }

    function quickOutbound() {
      Swal.fire({
        title: '긴급 출고',
        text: '주문서 번호를 입력하세요.',
        input: 'text',
        inputPlaceholder: 'SO-20250108-001',
        showCancelButton: true,
        confirmButtonText: '출고 생성',
        preConfirm: (orderNo) => {
          if (!orderNo) {
            Swal.showValidationMessage('주문서 번호를 입력해주세요.');
          }
          return orderNo;
        }
      }).then((result) => {
        if (result.isConfirmed) {
          // 기존 출고 생성 API 활용
          fetch('/bsn/soutbounds/create-from-order', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ orderNo: result.value })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              Swal.fire('성공!', `출고 "${data.outboundNo}"가 생성되었습니다.`, 'success');
            } else {
              Swal.fire('실패', data.message, 'error');
            }
          })
          .catch(() => {
            Swal.fire('오류', '출고 생성 중 오류가 발생했습니다.', 'error');
          });
        }
      });
    }

    function searchCustomer() {
      Swal.fire({
        title: '거래처 검색',
        input: 'text',
        inputPlaceholder: '거래처명을 입력하세요',
        showCancelButton: true,
        confirmButtonText: '검색',
        preConfirm: (keyword) => {
          if (!keyword) {
            Swal.showValidationMessage('검색어를 입력해주세요.');
          }
          return keyword;
        }
      }).then((result) => {
        if (result.isConfirmed) {
          // 거래처 검색 결과를 새 창에서 표시
          window.open(`/bsn/customer_search?keyword=${encodeURIComponent(result.value)}`, '_blank');
        }
      });
    }

    function todayReport() {
      window.open('/bsn/reports/today', '_blank');
    }

    function alertSummary() {
      fetch('/bsn/dashboard/alerts')
        .then(response => response.json())
        .then(data => {
          let alerts = [];
          
          if (data.creditRiskCustomers?.length > 0) {
            alerts.push(`🔴 여신 위험: ${data.creditRiskCustomers.length}건`);
          }
          if (data.delayedOrders?.length > 0) {
            alerts.push(`🟡 지연 출고: ${data.delayedOrders.length}건`);
          }
          if (data.expiringQuotations?.length > 0) {
            alerts.push(`🟠 견적 만료: ${data.expiringQuotations.length}건`);
          }
          
          if (alerts.length === 0) {
            Swal.fire('알림 요약', '✅ 현재 주의사항이 없습니다.', 'success');
          } else {
            Swal.fire('알림 요약', alerts.join('<br>'), 'warning');
          }
        })
        .catch(() => {
          Swal.fire('오류', '알림 정보를 불러올 수 없습니다.', 'error');
        });
    }

    // 페이지 로드 시 오늘의 요약 데이터 로드
    $(document).ready(function() {
      loadTodaySummary();
    });

    function loadTodaySummary() {
      // TODO: 실제 API 연동
      setTimeout(() => {
        $('#todayQuotations').text('12');
        $('#todayOrders').text('8');
        $('#todayOutbound').text('5');
        $('#todaySales').text('1.2억');
      }, 1000);
    }

    console.log('영업관리 메인 페이지 초기화 완료');
  </script>
</div>
</html>