<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{common/layouts/default}">
<head>
  <title>ì˜ì—…ê´€ë¦¬</title>
  <style>
    .card {
      transition: all 0.3s ease;
      border: none;
      box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0.3rem 2rem 0 rgba(58, 59, 69, 0.25);
    }
    
    .card-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: 600;
      border: none;
    }
    
    .menu-link {
      text-decoration: none;
      color: #5a5c69;
      font-weight: 500;
      transition: all 0.2s;
      display: block;
      padding: 8px 0;
      border-left: 3px solid transparent;
      padding-left: 12px;
    }
    
    .menu-link:hover {
      color: #4e73df;
      border-left-color: #4e73df;
      background-color: rgba(78, 115, 223, 0.05);
      text-decoration: none;
      margin-left: 5px;
    }
    
    .menu-icon {
      width: 20px;
      margin-right: 8px;
      color: #858796;
    }
    
    .menu-link:hover .menu-icon {
      color: #4e73df;
    }
    
    .main-title {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 15px;
      box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    .dashboard-card {
      background: linear-gradient(135deg, #1cc88a 0%, #13855c 100%);
    }
    
    .management-card {
      background: linear-gradient(135deg, #4e73df 0%, #224abe 100%);
    }
    
    .analytics-card {
      background: linear-gradient(135deg, #f6c23e 0%, #dda20a 100%);
    }
    
    .reports-card {
      background: linear-gradient(135deg, #e74a3b 0%, #c0392b 100%);
    }
  </style>
</head>
<div layout:fragment="content">
  <div class="container" id="bsn-main">
    
    <!-- ë©”ì¸ íƒ€ì´í‹€ -->
    <div class="main-title text-center mb-5 py-4">
      <h2 class="mb-2">
        <i class="fas fa-chart-line mr-3"></i>ì˜ì—…ê´€ë¦¬ ì‹œìŠ¤í…œ
      </h2>
      <p class="mb-0 opacity-75">
        í†µí•© ì˜ì—… í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬ ë° ì‹¤ì‹œê°„ ì„±ê³¼ ë¶„ì„
      </p>
    </div>

    <div class="row g-4">
      
      <!-- ğŸ“Š ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ -->
      <div class="col-md-6 col-lg-3 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-header dashboard-card text-white">
            <i class="fas fa-tachometer-alt mr-2"></i>
            ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ
          </div>
          <div class="card-body">
            <ul class="list-unstyled mb-0">
              <li>
                <a href="/bsn/dashboard" class="menu-link">
                  <i class="fas fa-chart-area menu-icon"></i>ë§¤ì¶œ í˜„í™© ëŒ€ì‹œë³´ë“œ
                </a>
              </li>
              <li>
                <a href="/bsn/dashboard#pipeline" class="menu-link">
                  <i class="fas fa-funnel-dollar menu-icon"></i>ì˜ì—… íŒŒì´í”„ë¼ì¸
                </a>
              </li>
              <li>
                <a href="/bsn/dashboard#kpi" class="menu-link">
                  <i class="fas fa-bullseye menu-icon"></i>í•µì‹¬ ì„±ê³¼ ì§€í‘œ
                </a>
              </li>
              <li>
                <a href="/bsn/dashboard#alerts" class="menu-link">
                  <i class="fas fa-exclamation-triangle menu-icon"></i>ì£¼ì˜ì‚¬í•­ ì•Œë¦¼
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- ğŸ“‹ ì˜ì—… ê´€ë¦¬ -->
      <div class="col-md-6 col-lg-3 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-header management-card text-white">
            <i class="fas fa-tasks mr-2"></i>
            ì˜ì—… ê´€ë¦¬
          </div>
          <div class="card-body">
            <ul class="list-unstyled mb-0">
              <li>
                <a href="/bsn/qot_list" class="menu-link">
                  <i class="fas fa-file-alt menu-icon"></i>ê²¬ì ì„œ ê´€ë¦¬
                </a>
              </li>
              <li>
                <a href="/bsn/order_management" class="menu-link">
                  <i class="fas fa-shopping-cart menu-icon"></i>ì£¼ë¬¸ì„œ ê´€ë¦¬
                </a>
              </li>
              <li>
                <a href="/bsn/soutbound" class="menu-link">
                  <i class="fas fa-shipping-fast menu-icon"></i>ì¶œê³  ê´€ë¦¬
                </a>
              </li>
              <li>
                <a href="/bsn/customer_management" class="menu-link">
                  <i class="fas fa-users menu-icon"></i>ê±°ë˜ì²˜ ê´€ë¦¬
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- ğŸ“Š ì˜ì—… ë¶„ì„ -->
      <div class="col-md-6 col-lg-3 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-header analytics-card text-white">
            <i class="fas fa-chart-pie mr-2"></i>
            ì˜ì—… ë¶„ì„
          </div>
          <div class="card-body">
            <ul class="list-unstyled mb-0">
              <li>
                <a href="/bsn/analytics/customer" class="menu-link">
                  <i class="fas fa-user-chart menu-icon"></i>ê³ ê°ë³„ ë§¤ì¶œ ë¶„ì„
                </a>
              </li>
              <li>
                <a href="/bsn/analytics/product" class="menu-link">
                  <i class="fas fa-box-open menu-icon"></i>ìƒí’ˆë³„ ìˆ˜ìµì„± ë¶„ì„
                </a>
              </li>
              <li>
                <a href="/bsn/analytics/employee" class="menu-link">
                  <i class="fas fa-user-tie menu-icon"></i>ì˜ì—…ì‚¬ì› ì„±ê³¼ ë¶„ì„
                </a>
              </li>
              <li>
                <a href="/bsn/analytics/trend" class="menu-link">
                  <i class="fas fa-trending-up menu-icon"></i>ë§¤ì¶œ íŠ¸ë Œë“œ ë¶„ì„
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- ğŸ“ˆ ë¦¬í¬íŠ¸ -->
      <div class="col-md-6 col-lg-3 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-header reports-card text-white">
            <i class="fas fa-file-download mr-2"></i>
            ë¦¬í¬íŠ¸
          </div>
          <div class="card-body">
            <ul class="list-unstyled mb-0">
              <li>
                <a href="/bsn/reports/daily" class="menu-link">
                  <i class="fas fa-calendar-day menu-icon"></i>ì¼ë³„ ë§¤ì¶œ ë¦¬í¬íŠ¸
                </a>
              </li>
              <li>
                <a href="/bsn/reports/monthly" class="menu-link">
                  <i class="fas fa-calendar-alt menu-icon"></i>ì›”ë³„ ì‹¤ì  ë¦¬í¬íŠ¸
                </a>
              </li>
              <li>
                <a href="/bsn/reports/annual" class="menu-link">
                  <i class="fas fa-calendar menu-icon"></i>ì—°ê°„ ì¢…í•© ë¦¬í¬íŠ¸
                </a>
              </li>
              <li>
                <a href="/bsn/reports/custom" class="menu-link">
                  <i class="fas fa-cog menu-icon"></i>ë§ì¶¤í˜• ë¦¬í¬íŠ¸
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
    <div class="row mt-5">
      <div class="col-12">
        <div class="card shadow">
          <div class="card-header bg-gradient-primary text-white">
            <h6 class="mb-0">
              <i class="fas fa-rocket mr-2"></i>ë¹ ë¥¸ ì‹¤í–‰
            </h6>
          </div>
          <div class="card-body">
            <div class="row text-center">
              <div class="col-md-2 col-6 mb-3">
                <button class="btn btn-outline-primary btn-lg btn-block py-3" onclick="location.href='/bsn/qot'">
                  <i class="fas fa-plus-circle fa-2x mb-2 d-block"></i>
                  ìƒˆ ê²¬ì ì„œ
                </button>
              </div>
              <div class="col-md-2 col-6 mb-3">
                <button class="btn btn-outline-success btn-lg btn-block py-3" onclick="quickOrderEntry()">
                  <i class="fas fa-cart-plus fa-2x mb-2 d-block"></i>
                  ë¹ ë¥¸ ì£¼ë¬¸
                </button>
              </div>
              <div class="col-md-2 col-6 mb-3">
                <button class="btn btn-outline-info btn-lg btn-block py-3" onclick="quickOutbound()">
                  <i class="fas fa-truck fa-2x mb-2 d-block"></i>
                  ê¸´ê¸‰ ì¶œê³ 
                </button>
              </div>
              <div class="col-md-2 col-6 mb-3">
                <button class="btn btn-outline-warning btn-lg btn-block py-3" onclick="searchCustomer()">
                  <i class="fas fa-search fa-2x mb-2 d-block"></i>
                  ê±°ë˜ì²˜ ì¡°íšŒ
                </button>
              </div>
              <div class="col-md-2 col-6 mb-3">
                <button class="btn btn-outline-secondary btn-lg btn-block py-3" onclick="todayReport()">
                  <i class="fas fa-chart-bar fa-2x mb-2 d-block"></i>
                  ì˜¤ëŠ˜ ì‹¤ì 
                </button>
              </div>
              <div class="col-md-2 col-6 mb-3">
                <button class="btn btn-outline-danger btn-lg btn-block py-3" onclick="alertSummary()">
                  <i class="fas fa-bell fa-2x mb-2 d-block"></i>
                  ì•Œë¦¼ ìš”ì•½
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ìµœê·¼ í™œë™ ìš”ì•½ -->
    <div class="row mt-4">
      <div class="col-lg-8">
        <div class="card shadow">
          <div class="card-header bg-gradient-success text-white">
            <h6 class="mb-0">
              <i class="fas fa-clock mr-2"></i>ìµœê·¼ í™œë™
            </h6>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-borderless" id="recentActivities">
                <tbody>
                  <tr>
                    <td><i class="fas fa-file-alt text-primary"></i></td>
                    <td>ê²¬ì ì„œ <strong>QT-20250108-001</strong> ìƒì„±ë¨</td>
                    <td class="text-muted">2ë¶„ ì „</td>
                  </tr>
                  <tr>
                    <td><i class="fas fa-shopping-cart text-success"></i></td>
                    <td>ì£¼ë¬¸ì„œ <strong>SO-20250108-005</strong> ìŠ¹ì¸ë¨</td>
                    <td class="text-muted">15ë¶„ ì „</td>
                  </tr>
                  <tr>
                    <td><i class="fas fa-shipping-fast text-info"></i></td>
                    <td>ì¶œê³  <strong>OUT-20250108-003</strong> ì™„ë£Œë¨</td>
                    <td class="text-muted">1ì‹œê°„ ì „</td>
                  </tr>
                  <tr>
                    <td><i class="fas fa-user text-warning"></i></td>
                    <td>ì‹ ê·œ ê±°ë˜ì²˜ <strong>ABCì½”í¼ë ˆì´ì…˜</strong> ë“±ë¡ë¨</td>
                    <td class="text-muted">3ì‹œê°„ ì „</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card shadow">
          <div class="card-header bg-gradient-info text-white">
            <h6 class="mb-0">
              <i class="fas fa-chart-line mr-2"></i>ì˜¤ëŠ˜ì˜ ìš”ì•½
            </h6>
          </div>
          <div class="card-body">
            <div class="row no-gutters">
              <div class="col-6 text-center border-right">
                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">ê²¬ì </div>
                <div class="h5 mb-0 font-weight-bold text-gray-800" id="todayQuotations">12</div>
              </div>
              <div class="col-6 text-center">
                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">ì£¼ë¬¸</div>
                <div class="h5 mb-0 font-weight-bold text-gray-800" id="todayOrders">8</div>
              </div>
            </div>
            <hr>
            <div class="row no-gutters">
              <div class="col-6 text-center border-right">
                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">ì¶œê³ </div>
                <div class="h5 mb-0 font-weight-bold text-gray-800" id="todayOutbound">5</div>
              </div>
              <div class="col-6 text-center">
                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">ë§¤ì¶œ</div>
                <div class="h5 mb-0 font-weight-bold text-gray-800" id="todaySales">1.2ì–µ</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    // ë¹ ë¥¸ ì•¡ì…˜ í•¨ìˆ˜ë“¤
    function quickOrderEntry() {
      Swal.fire({
        title: 'ë¹ ë¥¸ ì£¼ë¬¸ ì…ë ¥',
        html: `
          <div class="text-left">
            <div class="form-group">
              <label>ê±°ë˜ì²˜</label>
              <input id="quickCustomer" type="text" class="form-control" placeholder="ê±°ë˜ì²˜ëª… ê²€ìƒ‰">
            </div>
            <div class="form-group">
              <label>í’ˆëª©</label>
              <input id="quickItem" type="text" class="form-control" placeholder="í’ˆëª©ëª… ê²€ìƒ‰">
            </div>
            <div class="form-group">
              <label>ìˆ˜ëŸ‰</label>
              <input id="quickQty" type="number" class="form-control" value="1" min="1">
            </div>
          </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'ì£¼ë¬¸ì„œ ìƒì„±',
        cancelButtonText: 'ì·¨ì†Œ',
        preConfirm: () => {
          // TODO: ë¹ ë¥¸ ì£¼ë¬¸ ë¡œì§ êµ¬í˜„
          return true;
        }
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire('ì¤€ë¹„ì¤‘', 'ë¹ ë¥¸ ì£¼ë¬¸ ê¸°ëŠ¥ì„ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤.', 'info');
        }
      });
    }

    function quickOutbound() {
      Swal.fire({
        title: 'ê¸´ê¸‰ ì¶œê³ ',
        text: 'ì£¼ë¬¸ì„œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.',
        input: 'text',
        inputPlaceholder: 'SO-20250108-001',
        showCancelButton: true,
        confirmButtonText: 'ì¶œê³  ìƒì„±',
        preConfirm: (orderNo) => {
          if (!orderNo) {
            Swal.showValidationMessage('ì£¼ë¬¸ì„œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          }
          return orderNo;
        }
      }).then((result) => {
        if (result.isConfirmed) {
          // ê¸°ì¡´ ì¶œê³  ìƒì„± API í™œìš©
          fetch('/bsn/soutbounds/create-from-order', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ orderNo: result.value })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              Swal.fire('ì„±ê³µ!', `ì¶œê³  "${data.outboundNo}"ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            } else {
              Swal.fire('ì‹¤íŒ¨', data.message, 'error');
            }
          })
          .catch(() => {
            Swal.fire('ì˜¤ë¥˜', 'ì¶œê³  ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
          });
        }
      });
    }

    function searchCustomer() {
      Swal.fire({
        title: 'ê±°ë˜ì²˜ ê²€ìƒ‰',
        input: 'text',
        inputPlaceholder: 'ê±°ë˜ì²˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”',
        showCancelButton: true,
        confirmButtonText: 'ê²€ìƒ‰',
        preConfirm: (keyword) => {
          if (!keyword) {
            Swal.showValidationMessage('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          }
          return keyword;
        }
      }).then((result) => {
        if (result.isConfirmed) {
          // ê±°ë˜ì²˜ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ìƒˆ ì°½ì—ì„œ í‘œì‹œ
          window.open(`/bsn/customer_search?keyword=${encodeURIComponent(result.value)}`, '_blank');
        }
      });
    }

    function todayReport() {
      window.open('/bsn/reports/today', '_blank');
    }

    function alertSummary() {
      fetch('/bsn/dashboard/alerts')
        .then(response => response.json())
        .then(data => {
          let alerts = [];
          
          if (data.creditRiskCustomers?.length > 0) {
            alerts.push(`ğŸ”´ ì—¬ì‹  ìœ„í—˜: ${data.creditRiskCustomers.length}ê±´`);
          }
          if (data.delayedOrders?.length > 0) {
            alerts.push(`ğŸŸ¡ ì§€ì—° ì¶œê³ : ${data.delayedOrders.length}ê±´`);
          }
          if (data.expiringQuotations?.length > 0) {
            alerts.push(`ğŸŸ  ê²¬ì  ë§Œë£Œ: ${data.expiringQuotations.length}ê±´`);
          }
          
          if (alerts.length === 0) {
            Swal.fire('ì•Œë¦¼ ìš”ì•½', 'âœ… í˜„ì¬ ì£¼ì˜ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.', 'success');
          } else {
            Swal.fire('ì•Œë¦¼ ìš”ì•½', alerts.join('<br>'), 'warning');
          }
        })
        .catch(() => {
          Swal.fire('ì˜¤ë¥˜', 'ì•Œë¦¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
        });
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì˜¤ëŠ˜ì˜ ìš”ì•½ ë°ì´í„° ë¡œë“œ
    $(document).ready(function() {
      loadTodaySummary();
    });

    function loadTodaySummary() {
      // TODO: ì‹¤ì œ API ì—°ë™
      setTimeout(() => {
        $('#todayQuotations').text('12');
        $('#todayOrders').text('8');
        $('#todayOutbound').text('5');
        $('#todaySales').text('1.2ì–µ');
      }, 1000);
    }

    console.log('ì˜ì—…ê´€ë¦¬ ë©”ì¸ í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
  </script>
</div>
</html>