<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{common/layouts/default}">
<!-- ============================================
  - ì‘ì„±ì   : ê¹€í¬ì •
  - ìµœì´ˆì‘ì„± : 2025-06-18
  - ì„¤ëª…     : ì „ì(ì„¸ê¸ˆ)ê³„ì‚°ì„œê´€ë¦¬ í™”ë©´
  -----------------------------------------------
  [ ë³€ê²½ ì´ë ¥ ]
  - 2025-06-18 (ê¹€í¬ì •): title ë° ë‚´ìš© ì¶”ê°€
============================================ -->
<head>
  <title>ì „ì(ì„¸ê¸ˆ)ê³„ì‚°ì„œê´€ë¦¬</title>
  <!-- ag-Grid CSS -->
  <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>
</head>
<div layout:fragment="content">
  <div class="container-fluid p-3">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h2>ì „ì(ì„¸ê¸ˆ)ê³„ì‚°ì„œê´€ë¦¬</h2>
      <div>
        <button id="btn-multiple-transaction" class="btn btn-secondary">ë³µìˆ˜ê±°ë˜</button>
        <button id="btn-issue-to-nts" class="btn btn-primary">êµ­ì„¸ì²­ ë°œí–‰</button>
        <button id="btn-add-journal-entry" class="btn btn-success">ì „í‘œì¶”ê°€</button>
      </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-2">
      <li class="nav-item">
        <a class="nav-link active" aria-current="page" href="#" id="tab-sales">ë§¤ì¶œ</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" id="tab-purchase">ë§¤ì…</a>
      </li>
    </ul>

    <!-- Filters -->
    <div class="card mb-2">
      <div class="card-body">
        <div class="row g-3 align-items-center">
          <div class="col-auto">
            <label for="date-from" class="col-form-label">ì¼ì</label>
          </div>
          <div class="col-auto">
            <input type="date" id="date-from" class="form-control" value="2025-01-01">
          </div>
          <div class="col-auto">~</div>
          <div class="col-auto">
            <input type="date" id="date-to" class="form-control" value="2025-12-31">
          </div>
          <div class="col-auto">
            <label for="client-search" class="col-form-label">ê±°ë˜ì²˜</label>
          </div>
          <div class="col-auto">
            <input type="text" id="client-search" class="form-control">
          </div>
          <div class="col-auto">
            <button class="btn btn-outline-secondary">ğŸ”</button>
          </div>
          <div class="col-auto">
            <label for="status-filter" class="col-form-label">ìƒíƒœ</label>
          </div>
          <div class="col-auto">
            <select id="status-filter" class="form-select">
              <option selected>ì „ì²´</option>
              <option value="1">ì „ì†¡ì„±ê³µ</option>
              <option value="2">ë¯¸ë°œí–‰</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Tax Invoice Grid -->
    <div id="tax-invoice-grid" class="ag-theme-alpine" style="height: 350px; width: 100%;"></div>

    <!-- Journal Entry Grid -->
    <div class="mt-3">
        <div id="journal-entry-grid" class="ag-theme-alpine" style="height: 250px; width: 100%;"></div>
    </div>
    
    <!-- Summary Section -->
    <div class="row mt-2 g-2">
        <div class="col">
            <div class="card">
                <div class="card-header text-center fw-bold">ë§¤ì¶œ</div>
                <div class="card-body p-2">
                    <div class="row g-1">
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">11 ê³¼ì„¸</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">16 ìˆ˜ì¶œ</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">21 ì „ì</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">12 ì˜ì„¸</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">17 ì¹´ê³¼</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">22 í˜„ê³¼</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">13 ë©´ì„¸</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">18 ì¹´ë©´</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">23 í˜„ë©´</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">14 ê±´ë³„</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">19 ì¹´ì˜</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">24 í˜„ì˜</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">15 ê°„ì´</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">20 ë©´ê±´</button></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card">
                <div class="card-header text-center fw-bold">ë§¤ì…</div>
                <div class="card-body p-2">
                    <div class="row g-1">
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">51 ê³¼ì„¸</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">55 ìˆ˜ì…</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">59 ì¹´ì˜</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">52 ì˜ì„¸</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">56 ê¸ˆì „</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">60 ë©´ê±´</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">53 ë©´ì„¸</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">57 ì¹´ê³¼</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">61 í˜„ê³¼</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">54 ë¶ˆê³µ</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">58 ì¹´ë©´</button></div>
                        <div class="col-4"><button class="btn btn-sm btn-outline-secondary w-100">62 í˜„ë©´</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>

<script layout:fragment="script" type="text/javascript">
document.addEventListener('DOMContentLoaded', function () {
    // Tab switching logic
    $('.nav-tabs .nav-link').on('click', function(e) {
        e.preventDefault();
        $(this).tab('show');
        
        const isSalesTab = $(this).attr('id') === 'tab-sales';

        // Use setTimeout to avoid grid rendering issues
        setTimeout(() => {
            if (isSalesTab) {
                taxInvoiceGridOptions.api.setRowData(salesData);
            } else {
                taxInvoiceGridOptions.api.setRowData(purchaseData);
            }
        }, 0);
    });

    const formatNumber = params => params.value != null ? params.value.toLocaleString() : '';

    const taxInvoiceGridOptions = {
        columnDefs: [
            { headerName: '', field: 'chk', width: 50 }, // checkboxSelection, headerCheckboxSelection removed
            { headerName: 'ì›”', field: 'month', width: 60 },
            { headerName: 'ì¼', field: 'day', width: 60 },
            { headerName: 'ì½”ë“œ', field: 'clientCode', width: 80 },
            { headerName: 'ê±°ë˜ì²˜', field: 'clientName', width: 150 },
            { headerName: 'í’ˆëª©', field: 'itemName', width: 250 },
            { headerName: 'ìˆ˜ëŸ‰', field: 'qty', width: 80, type: 'numericColumn' },
            { headerName: 'ë‹¨ê°€', field: 'unitPrice', width: 120, type: 'numericColumn', valueFormatter: formatNumber },
            { headerName: 'ê³µê¸‰ê°€ì•¡', field: 'supplyPrice', width: 120, type: 'numericColumn', valueFormatter: formatNumber },
            { headerName: 'ì„¸ì•¡', field: 'tax', width: 100, type: 'numericColumn', valueFormatter: formatNumber },
            { headerName: 'ìƒíƒœ', field: 'status', width: 100 },
            { headerName: 'ìŠ¹ì¸ë²ˆí˜¸', field: 'approvalNo', width: 180 },
            { headerName: 'ë³µìˆ˜', field: 'isMultiple', width: 60, cellRenderer: params => params.value ? 'O' : '' },
            { headerName: 'ì „í‘œ', field: 'hasJournal', width: 60, cellRenderer: params => params.value ? 'O' : '' }
        ],
        defaultColDef: {
            sortable: true,
            resizable: true
        },
        rowSelection: {
            mode: 'multiple',
            enableClickSelection: false, // suppressRowClickSelection: true -> enableClickSelection: false
            checkboxes: true,
            headerCheckbox: true
        }
    };

    const journalEntryGridOptions = {
        columnDefs: [
            { headerName: '', field: 'chk', width: 50 }, // checkboxSelection, headerCheckboxSelection removed
            { headerName: 'ì›”', field: 'month', width: 60, editable: true },
            { headerName: 'ì¼', field: 'day', width: 60, editable: true },
            { headerName: 'ë²ˆí˜¸', field: 'no', width: 70 },
            { headerName: 'ìœ í˜•', field: 'type', width: 80, editable: true },
            { headerName: 'êµ¬ë¶„', field: 'category', width: 80, editable: true },
            { headerName: 'ì½”ë“œ', field: 'accountCode', width: 80, editable: true },
            { headerName: 'ê³„ì •ê³¼ëª©', field: 'accountName', width: 150, editable: true },
            { headerName: 'ì½”ë“œ', field: 'clientCode', width: 80, editable: true },
            { headerName: 'ê±°ë˜ì²˜', field: 'clientName', width: 150, editable: true },
            { headerName: 'ì°¨ë³€', field: 'debit', width: 120, type: 'numericColumn', editable: true, valueFormatter: params => params.value ? params.value.toLocaleString() : '' },
            { headerName: 'ëŒ€ë³€', field: 'credit', width: 120, type: 'numericColumn', editable: true, valueFormatter: params => params.value ? params.value.toLocaleString() : '' },
            { headerName: 'ì ìš”', field: 'description', width: 200, editable: true }
        ],
        rowData: [{}, {}, {}, {}], // Empty rows
        defaultColDef: {
            sortable: true,
            resizable: true
        },
        rowSelection: {
            mode: 'multiple',
            enableClickSelection: false,
            checkboxes: true,
            headerCheckbox: true
        },
        // Pinned bottom row for summary
        pinnedBottomRowData: [
            { accountName: 'ì „í‘œ ì†Œê³„', debit: 0, credit: 0 },
            { accountName: 'ì”ì•¡', debit: 0 }
        ]
    };

    const salesData = [
        { month: 3, day: 6, clientCode: '00100', clientName: 'ìë°”ìœ í†µ', itemName: 'ì—´ì‹¬íˆ ê³µë¶€í•˜ëŠ” ìë°”', qty: 2, unitPrice: 30000, supplyPrice: 60000, tax: 6000, status: 'ì „ì†¡ì„±ê³µ', approvalNo: '20250331-12345678', isMultiple: false, hasJournal: true },
        { month: 10, day: 25, clientCode: '00100', clientName: 'ìë°”ìœ í†µ', itemName: 'ìŠ¤í”„ë§ ë¶€íŠ¸ ì²˜ìŒë¶€í„° ê³µë¶€í•˜ê¸°', qty: 10, unitPrice: 27500, supplyPrice: 275000, tax: 27500, status: 'ì „ì†¡ì„±ê³µ', approvalNo: '20251026-12345678', isMultiple: true, hasJournal: true },
        { month: 11, day: 12, clientCode: '00100', clientName: 'ìë°”ìœ í†µ', itemName: 'ì—´ì‹¬íˆ ê³µë¶€í•˜ëŠ” ìë°” ì™¸', qty: null, unitPrice: null, supplyPrice: 450000, tax: 45000, status: 'ë¯¸ë°œí–‰', approvalNo: '', isMultiple: true, hasJournal: false }
    ];
    
    const purchaseData = [
        { month: 9, day: 3, clientCode: '00102', clientName: 'ì„œë¸”ë¦¿ ë¬¸êµ¬', itemName: 'ì‚¬ë¬´ìš©í’ˆ', qty: 2, unitPrice: 30000, supplyPrice: 60000, tax: 6000, status: 'ì „ì†¡ì„±ê³µ', approvalNo: '20250331-12345678', isMultiple: false, hasJournal: true }
    ];

    taxInvoiceGridOptions.rowData = salesData;

    agGrid.createGrid(document.querySelector('#tax-invoice-grid'), taxInvoiceGridOptions);
    agGrid.createGrid(document.querySelector('#journal-entry-grid'), journalEntryGridOptions);
});
</script>
</div>
</html>