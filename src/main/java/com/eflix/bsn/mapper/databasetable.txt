/* ─── 테이블 생성 ───────────────────────────── */
CREATE TABLE EFLIX.BSN_ITEM (
    ITEM_CODE    VARCHAR2(50 BYTE)  NOT NULL,
    ITEM_NAME    VARCHAR2(100 BYTE) NOT NULL,
    SPEC         VARCHAR2(100 BYTE),
    UNIT         VARCHAR2(50 BYTE),
    SALE_PRICE   NUMBER(15,2)       NOT NULL,
    TAX_RATE     NUMBER(5,2)  DEFAULT 0,
    REMARK       VARCHAR2(200 BYTE),
    CREATED_AT   TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,
    UPDATED_AT   TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,

    CONSTRAINT PK_BSN_ITEM
        PRIMARY KEY (ITEM_CODE)
);

/* ─── 컬럼 & 테이블 주석 ─────────────────────── */
COMMENT ON COLUMN EFLIX.BSN_ITEM.ITEM_CODE    IS '품목 코드 (PK)';
COMMENT ON COLUMN EFLIX.BSN_ITEM.ITEM_NAME    IS '품목 명';
COMMENT ON COLUMN EFLIX.BSN_ITEM.SPEC         IS '규격';
COMMENT ON COLUMN EFLIX.BSN_ITEM.UNIT         IS '단위';
COMMENT ON COLUMN EFLIX.BSN_ITEM.SALE_PRICE   IS '판매 단가';
COMMENT ON COLUMN EFLIX.BSN_ITEM.TAX_RATE     IS '부가세율(%)';
COMMENT ON COLUMN EFLIX.BSN_ITEM.REMARK       IS '비고';
COMMENT ON COLUMN EFLIX.BSN_ITEM.CREATED_AT   IS '등록일시';
COMMENT ON COLUMN EFLIX.BSN_ITEM.UPDATED_AT   IS '수정일시';
COMMENT ON TABLE  EFLIX.BSN_ITEM              IS '영업파트 품목 정보 테이블';

/* ─── 수정 시 UPDATED_AT 자동 갱신 트리거 ───── */
CREATE OR REPLACE TRIGGER EFLIX.TRG_BSN_ITEM_UPD
BEFORE UPDATE ON EFLIX.BSN_ITEM
FOR EACH ROW
BEGIN
    :NEW.UPDATED_AT := SYSTIMESTAMP;
END;
/

ALTER TRIGGER EFLIX.TRG_BSN_ITEM_UPD ENABLE;




CREATE TABLE EFLIX.QUOTATION_DETAIL (
    QUOTATION_NO  VARCHAR2(30 BYTE) NOT NULL,
    LINE_NO       NUMBER            NOT NULL,   -- 복합 PK
    ITEM_NAME     VARCHAR2(20 BYTE) NOT NULL,
    QTY           NUMBER(15,2)      NOT NULL,
    UNIT_PRICE    NUMBER(15,2)      NOT NULL,
    TOTAL_MONEY   VARCHAR2(30 BYTE) NOT NULL,
    REMARKS       VARCHAR2(100 BYTE),
    ITEM_CODE     VARCHAR2(20 BYTE),
    SPEC          VARCHAR2(100 BYTE),

    CONSTRAINT PK_QUOTATION_DETAIL
        PRIMARY KEY (QUOTATION_NO, LINE_NO),

    CONSTRAINT FK_QUOT_TO_QUOT_D
        FOREIGN KEY (QUOTATION_NO)
        REFERENCES EFLIX.QUOTATION (QUOTATION_NO)
);

CREATE TABLE ORDERS (
    ORDER_NO              VARCHAR2(30 BYTE)   NOT NULL,     
    QUOTATION_NO          VARCHAR2(30 BYTE),                 
    ORDER_DT              DATE                NOT NULL,
    EMP_CD                VARCHAR2(20 BYTE)   NOT NULL,
    PHONE_NUMBER          NUMBER              NOT NULL,
    DELIVERY_ADDR          VARCHAR2(200 BYTE)  NOT NULL,
    WAREHOUSE_CD          VARCHAR2(20 BYTE)   NOT NULL,
    DELIVERY_DT            DATE                NOT NULL,
    EXPECTED_PAYMENT_DT   DATE                NOT NULL,
    PAYMENT_TERMS         VARCHAR2(100 BYTE)  NOT NULL,
    TAX_INVOICE_ISSUE_YN  VARCHAR2(20 BYTE)   NOT NULL,
    CUSTOMER_CD           VARCHAR2(100 BYTE)  NOT NULL,
    CONSTRAINT PK_ORDERS PRIMARY KEY (ORDER_NO)
);

CREATE TABLE ORDERS_DETAIL (
    ORDER_NO        VARCHAR2(30 BYTE)    NOT NULL,  
    ITEM_CD         VARCHAR2(20 BYTE)    NOT NULL,
    ITEM_NAME       VARCHAR2(50 BYTE)    NOT NULL,
    QTY             NUMBER(10,2)         NOT NULL,
    UNIT_PRICE      NUMBER(15,2)         NOT NULL,
    DISCOUNT_RATE   NUMBER(5,2),
    AMOUNT          NUMBER(15,2),
    REMARKS         VARCHAR2(200 BYTE),
    CONSTRAINT PK_ORDERS_DETAIL PRIMARY KEY (ORDER_NO, ITEM_CD),
    CONSTRAINT FK_OD_ORDERS
        FOREIGN KEY (ORDER_NO)
        REFERENCES ORDERS (ORDER_NO)
);

CREATE TABLE SALES_OUTBOUND (
    OUTBOUND_NO      VARCHAR2(30 BYTE)   NOT NULL,  -- PK
    WRITE_DT         VARCHAR2(30 BYTE)   NOT NULL,  -- 작성일(문자형 저장)
    CUSTOMER_CD      VARCHAR2(20 BYTE)   NOT NULL,
    ORDER_DT         DATE                NOT NULL,  -- 주문일
    OUTBOUND_DT      DATE                NOT NULL,  -- 출고일
    MONEY            VARCHAR2(4 BYTE)    NOT NULL,  -- 통화 코드 등
    REMARKS          VARCHAR2(20 BYTE),
    CONSTRAINT PK_SALES_OUTBOUND PRIMARY KEY (OUTBOUND_NO)
);


CREATE TABLE SOUTBOUND_DETAIL (
    ORDER_NO   VARCHAR2(30 BYTE)  NOT NULL,
    ITEM_NAME  VARCHAR2(30 BYTE)  NOT NULL,
    STANDARD   VARCHAR2(30 BYTE)  NOT NULL,
    QTY        NUMBER             NOT NULL,
    UNIT       VARCHAR2(10 BYTE)  NOT NULL,
    REMARKS    VARCHAR2(30 BYTE)  NOT NULL,

    -- 기본 키
    CONSTRAINT PK_SOUTBOUND_DETAIL
        PRIMARY KEY (ORDER_NO),

    -- 외래 키 (주문/출고 헤더 테이블 연동)
    CONSTRAINT FK_SALES_OUT_TO_SOUT_DET
        FOREIGN KEY (ORDER_NO)
        REFERENCES EFLIX.SALES_OUTBOUND (OUTBOUND_NO)
);