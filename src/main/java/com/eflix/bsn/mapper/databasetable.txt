/* ─── CREDIT_MANAGEMENT (여신 관리) ───────────────── */
CREATE TABLE EFLIX.CREDIT_MANAGEMENT (
    CUSTOMER_CD          VARCHAR2(20)   NOT NULL,                      -- PK · FK
    CREDIT_LIMIT         NUMBER(15,2)   NOT NULL,                      -- 한도
    CREDIT_USED          NUMBER(15,2)   DEFAULT 0        NOT NULL,     -- 사용액
    PAYMENT_TERMS        VARCHAR2(30)   DEFAULT 'Net 30' NOT NULL,     -- 결제조건
    OVERDUE_AMOUNT       NUMBER(15,2)   DEFAULT 0        NOT NULL,     -- 연체금액
    CREDIT_STATUS        VARCHAR2(20)   DEFAULT 'NORMAL' NOT NULL,     -- 상태
    CREDIT_HOLD_FLG      CHAR(1)        DEFAULT 'N'      NOT NULL,     -- 보류(Y/N)
    CREDIT_HOLD_REASON   VARCHAR2(200),
    CREDIT_HOLD_UNTIL    DATE,
    CREDIT_RATING        VARCHAR2(10),
    GUARANTEE_AMOUNT     NUMBER(15,2)   DEFAULT 0        NOT NULL,     -- 담보
    LOCK_ORDER_THRESHOLD NUMBER(15,2)   DEFAULT 0        NOT NULL,     -- 차단기준
    EFFECTIVE_FROM       DATE           NOT NULL,
    EFFECTIVE_TO         DATE           NOT NULL,
    GRACE_PERIOD         NUMBER         DEFAULT 0        NOT NULL,     -- 연체허용일
    LAST_SETTLE_DT       DATE,
    CREATED_AT           TIMESTAMP(6)   DEFAULT SYSTIMESTAMP NOT NULL,
    UPDATED_AT           TIMESTAMP(6)   DEFAULT SYSTIMESTAMP NOT NULL,
    CO_IDX               VARCHAR2(30),
    TRADE_STOP_FLG       CHAR(1)        DEFAULT 'N'      NOT NULL,     -- 거래정지 Y/N
    TRADE_STOP_REASON    VARCHAR2(200),
    TRADE_STOP_DT        DATE,
    TRADE_RESUME_DT      DATE,

    CONSTRAINT PK_CREDIT_MANAGEMENT
        PRIMARY KEY (CUSTOMER_CD),

    CONSTRAINT FK_CUST_TO_CREDIT_MAN
        FOREIGN KEY (CUSTOMER_CD)
        REFERENCES EFLIX.CUSTOMERS (CUSTOMER_CD),

    CONSTRAINT CHK_TRADE_STOP_FLG
        CHECK (TRADE_STOP_FLG IN ('Y', 'N'))
);

/* ─── 컬럼 주석 유지 ───────────────────────────── */
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.CUSTOMER_CD          IS '거래처 코드';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.CREDIT_LIMIT         IS '신용 한도 금액';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.CREDIT_USED          IS '사용된 신용 금액';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.PAYMENT_TERMS        IS '결제 조건 (예: Net 30)';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.OVERDUE_AMOUNT       IS '연체 금액';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.CREDIT_STATUS        IS '여신 상태 (NORMAL, HOLD, OVERDUE 등)';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.CREDIT_HOLD_FLG      IS '여신 보류 여부 (Y/N)';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.CREDIT_HOLD_REASON   IS '여신 보류 사유';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.CREDIT_HOLD_UNTIL    IS '여신 보류 해제 예정일';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.CREDIT_RATING        IS '여신 등급 (예: A, B, C)';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.GUARANTEE_AMOUNT     IS '담보 또는 보증금 금액';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.LOCK_ORDER_THRESHOLD IS '한도 초과 시 자동 차단 기준 금액';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.EFFECTIVE_FROM       IS '적용 시작일';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.EFFECTIVE_TO         IS '적용 종료일';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.GRACE_PERIOD         IS '최대 연체 허용 일수';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.LAST_SETTLE_DT       IS '최종 결제 완료 일자';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.CREATED_AT           IS '레코드 생성 일시';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.UPDATED_AT           IS '레코드 수정 일시';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.TRADE_STOP_FLG       IS '거래정지 여부 (Y/N)';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.TRADE_STOP_REASON    IS '거래정지 사유';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.TRADE_STOP_DT        IS '거래정지 시작일';
COMMENT ON COLUMN EFLIX.CREDIT_MANAGEMENT.TRADE_RESUME_DT      IS '거래재개 예정일';

/* ───────────────── CUSTOMERS ───────────────── */
CREATE TABLE EFLIX.CUSTOMERS (
    CUSTOMER_CD       VARCHAR2(20 BYTE)  NOT NULL,      -- PK
    CUSTOMER_NM       VARCHAR2(100 BYTE) NOT NULL,
    REPRESENTATIVE_NM VARCHAR2(50 BYTE)  NOT NULL,
    BUSINESS_REG_NO   VARCHAR2(20 BYTE)  NOT NULL,
    ADDRESS           VARCHAR2(200 BYTE) NOT NULL,
    PHONE_NO          VARCHAR2(20 BYTE)  NOT NULL,
    EMAIL             VARCHAR2(100 BYTE) NOT NULL,
    SALES_EMP_CD      VARCHAR2(20 BYTE)  NOT NULL,
    CREDIT_GRADE      VARCHAR2(10 BYTE)  NOT NULL,
    USE_YN            CHAR(1 BYTE)       NOT NULL,
    REG_DT            DATE               NOT NULL,
    UPD_DT            DATE               NOT NULL,
    DISCOUNT_RATE     NUMBER(5,2) DEFAULT 0 NOT NULL,
    CO_IDX            VARCHAR2(30 BYTE),

    CONSTRAINT PK_CUSTOMERS
        PRIMARY KEY (CUSTOMER_CD)
);


/* ───────────────── ORDERS ───────────────────── */
CREATE TABLE EFLIX.ORDERS (
    ORDER_NO        VARCHAR2(50 BYTE)   NOT NULL,      -- PK
    ORDER_DT        DATE                NOT NULL,
    PAYMENT_TERMS   VARCHAR2(100 BYTE)  NOT NULL,
    CUSTOMER_CD     VARCHAR2(100 BYTE)  NOT NULL,      -- FK → CUSTOMERS
    CO_IDX          VARCHAR2(30 BYTE),
    ORDER_WRITER    VARCHAR2(50 BYTE),
    REMARKS         VARCHAR2(100 BYTE),

    CONSTRAINT PK_ORDERS
        PRIMARY KEY (ORDER_NO),

    CONSTRAINT FK_ORDERS_CUSTOMER
        FOREIGN KEY (CUSTOMER_CD)
        REFERENCES EFLIX.CUSTOMERS (CUSTOMER_CD)
);

/* ─── BSN_ITEM (영업 품목 마스터) ───────────────── */
CREATE TABLE EFLIX.BSN_ITEM (
    ITEM_CODE   VARCHAR2(50)   NOT NULL,                -- PK
    ITEM_NAME   VARCHAR2(100)  NOT NULL,                -- 품목명
    SPEC        VARCHAR2(100),                          -- 규격
    UNIT        VARCHAR2(50),                           -- 단위
    SALE_PRICE  NUMBER(15,2)   NOT NULL,                -- 판매단가
    TAX_RATE    NUMBER(5,2)    DEFAULT 0,               -- 부가세율(%)
    REMARK      VARCHAR2(200),                          -- 비고
    CREATED_AT  TIMESTAMP(6)   DEFAULT SYSTIMESTAMP NOT NULL,
    UPDATED_AT  TIMESTAMP(6)   DEFAULT SYSTIMESTAMP NOT NULL,
    CO_IDX      VARCHAR2(30),                           -- 회사 식별자(FK 필요 시 추가)

    CONSTRAINT PK_BSN_ITEM
        PRIMARY KEY (ITEM_CODE)
);

/* ─── 컬럼·테이블 주석 ───────────────────────────── */
COMMENT ON COLUMN EFLIX.BSN_ITEM.ITEM_CODE   IS '품목 코드 (PK)';
COMMENT ON COLUMN EFLIX.BSN_ITEM.ITEM_NAME   IS '품목 명';
COMMENT ON COLUMN EFLIX.BSN_ITEM.SPEC        IS '규격';
COMMENT ON COLUMN EFLIX.BSN_ITEM.UNIT        IS '단위';
COMMENT ON COLUMN EFLIX.BSN_ITEM.SALE_PRICE  IS '판매 단가';
COMMENT ON COLUMN EFLIX.BSN_ITEM.TAX_RATE    IS '부가세율(%)';
COMMENT ON COLUMN EFLIX.BSN_ITEM.REMARK      IS '비고';
COMMENT ON COLUMN EFLIX.BSN_ITEM.CREATED_AT  IS '등록일시';
COMMENT ON COLUMN EFLIX.BSN_ITEM.UPDATED_AT  IS '수정일시';
COMMENT ON TABLE  EFLIX.BSN_ITEM             IS '영업파트 품목 정보 테이블';

/* ─── UPDATED_AT 자동 갱신 트리거 ──────────────── */
CREATE OR REPLACE TRIGGER EFLIX.TRG_BSN_ITEM_UPD
BEFORE UPDATE ON EFLIX.BSN_ITEM
FOR EACH ROW
BEGIN
    :NEW.UPDATED_AT := SYSTIMESTAMP;
END;
/

ALTER TRIGGER EFLIX.TRG_BSN_ITEM_UPD ENABLE;

/* ─── ORDERS_DETAIL (주문 상세) ────────────────── */
CREATE TABLE EFLIX.ORDERS_DETAIL (
    ORDER_NO      VARCHAR2(30)   NOT NULL,   -- PK · FK → ORDERS
    LINE_NO       NUMBER         NOT NULL,   -- PK
    ITEM_CODE     VARCHAR2(50)   NOT NULL,   -- 품목코드
    ITEM_NAME     VARCHAR2(50)   NOT NULL,   -- 품목명
    SPEC          VARCHAR2(100),             -- 규격
    QTY           NUMBER(10,2)   NOT NULL,   -- 수량
    UNIT_PRICE    NUMBER(15,2)   NOT NULL,   -- 단가
    SUPPLY_AMOUNT NUMBER(15,2),              -- 공급가액
    TAX_AMOUNT    NUMBER(15,2),              -- 부가세
    TOTAL_AMOUNT  NUMBER(15,2),              -- 합계금액
    REMARKS       VARCHAR2(200),             -- 비고
    CO_IDX        VARCHAR2(30),              -- 회사 식별자(FK 필요 시)
    OUTBOUND_DT   DATE          NOT NULL,    -- 출고일
    CATCH_DT      DATE          NOT NULL,    -- 납기일
    OUT_STATE     VARCHAR2(20),              -- 출고상태

    CONSTRAINT PK_ORDERS_DETAIL
        PRIMARY KEY (ORDER_NO, LINE_NO),

    CONSTRAINT FK_ORDERS_TO_ORDERS_DETAIL
        FOREIGN KEY (ORDER_NO)
        REFERENCES EFLIX.ORDERS (ORDER_NO)
);

/* ─── 컬럼 주석 ──────────────────────────────── */
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.ORDER_NO      IS '주문서 번호';
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.LINE_NO       IS '순번';
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.ITEM_CODE     IS '품목코드';
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.ITEM_NAME     IS '품목명';
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.SPEC          IS '규격';
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.QTY           IS '수량';
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.UNIT_PRICE    IS '단가';
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.SUPPLY_AMOUNT IS '공급가액';
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.TAX_AMOUNT    IS '부가세';
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.TOTAL_AMOUNT  IS '합계금액';
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.REMARKS       IS '비고';
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.OUTBOUND_DT   IS '출고일';
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.CATCH_DT      IS '납기일';
COMMENT ON COLUMN EFLIX.ORDERS_DETAIL.OUT_STATE     IS '출고상태';